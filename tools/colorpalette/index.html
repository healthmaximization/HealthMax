<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fashion Palette — Men's Outfit Colors</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  /* =========================
     Theme & layout
     ========================= */
  :root{
    --bg1:#0F2027;
    --bg2:#203A43;
    --bg3:#2C5364;
    --card:#1e1e1e;
    --muted:#a0a0a0;
    --accent:#28a745;
    --nav-start:#0a1a2f;
    --nav-end:#063b6a;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    color:#eaeaea;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:28px;
  }

  /* Header */
  header{ text-align:center; margin-bottom:14px; max-width:1100px; width:100% }
  .brand-wrap{ display:flex; align-items:center; justify-content:center; gap:14px; flex-wrap:wrap }
  .logo{ width:88px; height:88px; border-radius:50%; object-fit:cover; display:block; }
  h1{ font-size:28px; margin:6px 0; font-weight:700; color:#f6f7f8; }
  .subtitle{ color:var(--muted); margin-top:6px; }

  /* Navigation - restored blue style */
  .main-nav{
    width:100%;
    max-width:1100px;
    margin: 14px 0 20px 0;
    padding:12px 16px;
    border-radius:12px;
    background: linear-gradient(90deg,var(--nav-start),var(--nav-end));
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    display:flex;
    justify-content:center;
    gap:12px;
  }
  .main-nav a{
    color:#eaf4ff;
    text-decoration:none;
    padding:10px 16px;
    border-radius:10px;
    font-weight:600;
    transition: all .14s;
  }
  .main-nav a:hover{ transform: translateY(-2px); background: rgba(255,255,255,0.04); }
  .main-nav a.active{ background: rgba(255,255,255,0.08); box-shadow: inset 0 -2px 6px rgba(0,0,0,0.12); }

  /* Main container */
  main{ width:100%; max-width:1100px; display:block; }

  /* Card */
  .card{
    background: linear-gradient(180deg,var(--card), #0f1012);
    padding:20px;
    border-radius:14px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.45);
    margin-bottom:18px;
  }

  /* Beehiiv */
  .bee-wrap{
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:360px;
    padding:18px;
  }
  .bee-embed{
    width:100%;
    max-width:720px;
    height:360px;
    border-radius:12px;
    border: none;
    display:block;
    background: #fff; /* if embed empty, show white box */
  }

  /* Upload area */
  .upload-area{
    border-radius:12px;
    padding:26px;
    background: var(--glass);
    border: 1px dashed rgba(255,255,255,0.04);
    text-align:center;
    cursor:pointer;
    transition: transform .16s, box-shadow .16s;
  }
  .upload-area:hover{ transform: translateY(-6px); box-shadow: 0 18px 48px rgba(0,0,0,0.55); }
  .upload-instructions{ color:var(--muted); margin-top:8px; font-size:14px; }

  input[type="file"]{ display:none; }

  #previewImage{
    display:block;
    max-width:360px;
    border-radius:12px;
    margin-top:14px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.55);
  }

  .controls{ display:flex; justify-content:center; gap:10px; margin-top:12px; }

  .btn{
    background: var(--accent);
    color: #fff;
    border: none;
    padding:10px 14px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 8px 20px rgba(40,167,69,0.16);
  }
  .btn.secondary{ background:#0a1a2f; box-shadow:none; }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

  /* Palette grid */
  .palette-grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:16px;
    margin-top:18px;
  }
  .swatch-card{
    display:flex;
    gap:14px;
    padding:12px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    align-items:flex-start;
    transition: transform .16s, box-shadow .16s;
  }
  .swatch-card:hover{ transform: translateY(-6px); box-shadow: 0 14px 36px rgba(0,0,0,0.5); }
  .swatch-sample{
    width:120px;
    height:86px;
    border-radius:10px;
    border: 1px solid rgba(255,255,255,0.04);
    flex-shrink:0;
    box-shadow: inset 0 -20px 40px rgba(0,0,0,0.08);
  }
  .swatch-meta{ flex:1 }
  .color-name{ font-weight:700; font-size:16px; color:#f6f7f8; }
  .color-role{ color:var(--muted); font-size:13px; margin-top:6px; }
  .color-reason{ margin-top:8px; color:#e6e6e6; font-size:14px; line-height:1.35; }

  .advice-grid{
    display:grid;
    grid-template-columns: repeat(3,1fr);
    gap:12px;
    margin-top:18px;
  }
  .advice-card{
    background:#0d0f11;
    padding:12px;
    border-radius:10px;
    min-height:86px;
  }
  .section-title{ font-weight:700; margin-bottom:6px; color:#f6f7f8; }

  .muted{ color:var(--muted); }

  footer{ color:var(--muted); font-size:13px; margin-top:20px; text-align:center; }

  @media (max-width:960px){
    .palette-grid{ grid-template-columns: 1fr; }
    .advice-grid{ grid-template-columns: 1fr; }
    .bee-embed{ height:300px; }
    .swatch-sample{ width:86px; height:64px; }
  }
</style>
</head>
<body>

<header>
  <div class="brand-wrap">
    <img class="logo" src="https://yt3.ggpht.com/6s8JL9X0gjAA2Toh9htfTY_HnaRtDTvd6cuV5U_vuAT15WTnsa07J8CHrvG6cgHkeaD25qemDA=s600-c-k-c0x00ffffff-no-rj-rp-mo" alt="Ascent logo">
    <div>
      <h1>Fashion Palette — Outfit Colors That Suit You</h1>
      <div class="subtitle">Upload a clear photo. We analyze skin, eyes & hair to recommend masculine wardrobe colors and explain why each suits you.</div>
    </div>
  </div>
</header>

<nav class="main-nav" role="navigation" aria-label="Main navigation">
  <a href="/">Home</a>
  <a href="/tools/" class="active">Tools</a>
  <a href="https://store.ascentimprovement.com/" target="_blank" rel="noopener">Store</a>
</nav>

<main>
  <!-- Subscribe (beehiiv embed) -->
  <section class="card" id="subscribeCard" style="display:none" aria-hidden="false">
    <div class="bee-wrap" role="region" aria-label="Subscribe to unlock">
      <!-- Keep the embed script (it may replace iframe contents) -->
      <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
      <iframe
        src="https://subscribe-forms.beehiiv.com/d8a629a3-7339-417f-b674-2947ff9c2450"
        class="bee-embed"
        frameborder="0"
        scrolling="no"
        title="Subscribe form (beehiiv)">
      </iframe>
    </div>
  </section>

  <!-- Upload -->
  <section class="card" id="uploadCard" style="display:none">
    <div id="uploadArea" class="upload-area" tabindex="0" role="button" aria-label="Upload photo">
      <strong>Click or drop a clear photo of your face</strong>
      <div class="upload-instructions muted">Natural lighting is best. Analysis runs locally in your browser; no image is uploaded.</div>
      <input id="fileInput" type="file" accept="image/*" aria-label="Choose a photo to upload">
      <img id="previewImage" src="" alt="photo preview" style="display:none">
      <div class="controls">
        <button id="analyzeBtn" class="btn" style="display:none">Analyze</button>
      </div>
    </div>
  </section>

  <!-- Palette + advice -->
  <section class="card" id="paletteCard" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <div class="section-title">Your Personalized Fashion Palette</div>
        <div class="muted">Masculine wardrobe staples with clear explanations — why each color suits your skin, hair, or eyes.</div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="downloadBtn" class="btn">Download Palette</button>
        <button id="uploadAnotherBtn" class="btn secondary">Upload Another</button>
      </div>
    </div>

    <div id="paletteGrid" class="palette-grid" aria-live="polite" style="margin-top:16px"></div>

    <div class="advice-grid" style="margin-top:18px">
      <div class="advice-card" aria-live="polite">
        <div class="section-title">Outfit combinations</div>
        <div id="comboText" class="muted"></div>
      </div>
      <div class="advice-card">
        <div class="section-title">Season guidance</div>
        <div id="seasonText" class="muted"></div>
      </div>
      <div class="advice-card">
        <div class="section-title">Jewelry advice</div>
        <div id="jewelryText" class="muted"></div>
      </div>
    </div>
  </section>
</main>

<footer>Private, local analysis — no images are sent to any server. Built for men's wardrobe basics.</footer>

<script>
/* ============================================================
   Full client-side behavior
   - Uses localStorage key: "emailSubmitted"
   - If emailSubmitted !== 'true' -> show Beehiiv embed (subscribeCard)
   - If emailSubmitted === 'true'  -> show uploadCard
   - Listens for storage events + polls as fallback
   - Performs client-side image analysis and renders fashion palette
   ============================================================ */

/* ---------------------------
   Fashion color bank (masculine staples)
   --------------------------- */
const FASHION_COLORS = [
  { name: 'Navy', hex: '#0B3D91' },
  { name: 'Charcoal', hex: '#2F3542' },
  { name: 'Black', hex: '#0F1112' },
  { name: 'White', hex: '#F7F7F7' },
  { name: 'Dark Brown', hex: '#5A381E' },
  { name: 'Camel', hex: '#C29B6D' },
  { name: 'Olive', hex: '#6B8E23' },
  { name: 'Khaki', hex: '#BDB48F' },
  { name: 'Denim Blue', hex: '#2C6EB2' },
  { name: 'Stone Gray', hex: '#9EA3A8' }
];

/* ---------------------------
   DOM elements
   --------------------------- */
const subscribeCard = document.getElementById('subscribeCard');
const uploadCard = document.getElementById('uploadCard');
const paletteCard = document.getElementById('paletteCard');

const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const previewImage = document.getElementById('previewImage');
const analyzeBtn = document.getElementById('analyzeBtn');

const paletteGrid = document.getElementById('paletteGrid');
const comboText = document.getElementById('comboText');
const seasonText = document.getElementById('seasonText');
const jewelryText = document.getElementById('jewelryText');

const downloadBtn = document.getElementById('downloadBtn');
const uploadAnotherBtn = document.getElementById('uploadAnotherBtn');

let lastAnalysis = null;
let lastSeenFlag = localStorage.getItem('emailSubmitted') || 'false';

/* ---------------------------
   Gating helpers (use key: emailSubmitted)
   --------------------------- */
function isSubscribed() {
  return localStorage.getItem('emailSubmitted') === 'true';
}

function updateUIForSubscription() {
  if (isSubscribed()) {
    subscribeCard.style.display = 'none';
    uploadCard.style.display = 'block';
  } else {
    subscribeCard.style.display = 'block';
    uploadCard.style.display = 'none';
    paletteCard.style.display = 'none';
  }
}

/* If user visits the subscribe confirmation URL, set the flag */
if (window.location.pathname === '/subscribe-confirmation') {
  try { localStorage.setItem('emailSubmitted', 'true'); } catch (e) { /* ignore */ }
}

/* Initial UI */
updateUIForSubscription();

/* Listen for cross-tab changes */
window.addEventListener('storage', (e) => {
  if (e.key === 'emailSubmitted') {
    updateUIForSubscription();
    if (isSubscribed() && lastAnalysis) {
      // show cached analysis if available
      renderPaletteFromAnalysis(lastAnalysis);
    }
  }
});

/* Poll as fallback (some embeds can't trigger storage event) */
setInterval(() => {
  const now = localStorage.getItem('emailSubmitted') || 'false';
  if (now !== lastSeenFlag) {
    lastSeenFlag = now;
    updateUIForSubscription();
    if (isSubscribed() && lastAnalysis) renderPaletteFromAnalysis(lastAnalysis);
  }
}, 800);

/* ---------------------------
   Upload interactions
   --------------------------- */
uploadArea.addEventListener('click', (e) => {
  if (!isSubscribed()) {
    // If not subscribed, scroll to embed to encourage signup
    subscribeCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }
  fileInput.click();
});

uploadArea.addEventListener('keydown', (e) => {
  if ((e.key === 'Enter' || e.key === ' ') && isSubscribed()) {
    fileInput.click(); e.preventDefault();
  }
});

/* Drag & drop */
uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.style.boxShadow = '0 18px 48px rgba(0,0,0,0.5)';
});
uploadArea.addEventListener('dragleave', (e) => {
  e.preventDefault();
  uploadArea.style.boxShadow = '';
});
uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.style.boxShadow = '';
  if (!isSubscribed()) {
    subscribeCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }
  const f = e.dataTransfer.files && e.dataTransfer.files[0];
  if (f) handleFile(f);
});

/* File selection */
fileInput.addEventListener('change', (e) => {
  const f = e.target.files && e.target.files[0];
  if (f) handleFile(f);
});

function handleFile(file) {
  if (!file.type.startsWith('image/')) {
    alert('Please upload an image file (jpg, png).');
    return;
  }
  const reader = new FileReader();
  reader.onload = (ev) => {
    previewImage.src = ev.target.result;
    previewImage.style.display = 'block';
    // run analysis
    analyzeImageAndMaybeRender(ev.target.result);
  };
  reader.readAsDataURL(file);
}

/* ---------------------------
   Client-side image analysis
   - Extracts approximate skin / eye / hair average colors
   - Infers skin undertone, eye tone, hair shade
   - Maps to nearest fashion staples, generates reasons
   --------------------------- */

function analyzeImageAndMaybeRender(dataUrl) {
  clientSideImageAnalysis(dataUrl).then(analysis => {
    lastAnalysis = analysis;
    if (isSubscribed()) {
      renderPaletteFromAnalysis(analysis);
    } else {
      // keep analysis cached; show subscribe card and instruct user to sign up
      updateUIForSubscription();
      subscribeCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // When they subscribe in another tab, storage event / poll will call renderPaletteFromAnalysis
    }
  }).catch(err => {
    console.error('analysis error', err);
    alert('Image analysis failed. Try another photo or different lighting.');
  });
}

function clientSideImageAnalysis(dataUrl) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = 'Anonymous';
    img.onload = () => {
      // scale to manageable size
      const maxDim = 420;
      let w = img.width, h = img.height;
      if (Math.max(w, h) > maxDim) {
        if (w > h) { h = Math.round(h * maxDim / w); w = maxDim; } else { w = Math.round(w * maxDim / h); h = maxDim; }
      }
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, w, h);

      // define sampling boxes (heuristic)
      const skinBox = { x: Math.round(w*0.25), y: Math.round(h*0.35), width: Math.round(w*0.5), height: Math.round(h*0.28) };
      const hairBox = { x: 0, y: 0, width: w, height: Math.round(h*0.20) }; // top portion
      const eyeBox = { x: Math.round(w*0.25), y: Math.round(h*0.27), width: Math.round(w*0.5), height: Math.round(h*0.12) };

      const skinAvg = sampleRegionAvg(ctx, skinBox);
      const hairAvg = sampleRegionAvg(ctx, hairBox);
      const eyeAvg = sampleRegionAvg(ctx, eyeBox);

      const skinUndertone = estimateUndertone(skinAvg);
      const eyeTone = classifyEye(eyeAvg);
      const hairShade = classifyHairShade(hairAvg);

      const mapped = mapToFashionPalette([skinAvg, hairAvg, eyeAvg]);

      // per-color reasons
      const paletteWithReasons = mapped.map(c => ({
        name: c.name,
        hex: c.hex,
        reason: generateReasonText(c, skinUndertone, eyeTone, hairShade)
      }));

      // advice
      const advice = generateAdvice(skinUndertone, paletteWithReasons.map(p => p.name));

      resolve({
        skinAvg, hairAvg, eyeAvg,
        skinUndertone, eyeTone, hairShade,
        palette: paletteWithReasons,
        advice
      });
    };
    img.onerror = (e) => reject(e);
    img.src = dataUrl;
  });
}

/* sample average color from a region */
function sampleRegionAvg(ctx, box) {
  const w = ctx.canvas.width, h = ctx.canvas.height;
  const x0 = Math.max(0, Math.min(w-1, box.x));
  const y0 = Math.max(0, Math.min(h-1, box.y));
  const bw = Math.max(1, Math.min(box.width, w - x0));
  const bh = Math.max(1, Math.min(box.height, h - y0));
  try {
    const data = ctx.getImageData(x0, y0, bw, bh).data;
    let r = 0, g = 0, b = 0, count = 0;
    const step = 6; // sample every Nth pixel
    for (let i = 0; i < data.length; i += 4 * step) {
      const alpha = data[i+3];
      if (alpha < 120) continue;
      const rr = data[i], gg = data[i+1], bb = data[i+2];
      const brightness = (rr*299 + gg*587 + bb*114) / 1000;
      if (brightness > 252) continue; // skip near white
      r += rr; g += gg; b += bb; count++;
    }
    if (count === 0) return { r: 180, g: 160, b: 140 }; // fallback
    return { r: Math.round(r/count), g: Math.round(g/count), b: Math.round(b/count) };
  } catch (e) {
    // cross-origin or other issues -> fallback neutral tones
    return { r: 180, g: 160, b: 140 };
  }
}

/* ---------------------------
   Color helpers and classifiers
   --------------------------- */
function rgbToHex(r,g,b){
  const toHex = n => ("0" + Math.max(0, Math.min(255, Math.round(n))).toString(16)).slice(-2);
  return "#" + toHex(r) + toHex(g) + toHex(b);
}
function hexToRgb(hex){
  const h = hex.replace('#','');
  const bigint = parseInt(h, 16);
  return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
}
function colorDistanceSq(c1,c2){
  const dr = c1.r - c2.r, dg = c1.g - c2.g, db = c1.b - c2.b;
  return dr*dr + dg*dg + db*db;
}

function estimateUndertone(rgb){
  // simple heuristic
  if (rgb.r - rgb.g > 12 && rgb.r - rgb.b > 10) return 'warm';
  if (rgb.b - rgb.r > 8) return 'cool';
  return 'neutral';
}

function classifyEye(rgb){
  const { r,g,b } = rgb;
  if (b > r + 15 && b > g + 10) return 'blue';
  if (g > r + 12 && g > b + 8) return 'green';
  if (r > g && r > b) return 'brown';
  return 'neutral';
}

function classifyHairShade(rgb){
  const bright = (rgb.r*299 + rgb.g*587 + rgb.b*114) / 1000;
  if (bright < 60) return 'very dark';
  if (bright < 110) return 'dark';
  if (bright < 170) return 'light';
  return 'very light';
}

/* ---------------------------
   Map to fashion palette
   --------------------------- */
function mapToFashionPalette(sampleRgbs){
  // sampleRgbs: [skinAvg, hairAvg, eyeAvg] prioritized
  const pool = FASHION_COLORS.map(c => ({...c, rgb: hexToRgb(c.hex)}));
  const picked = [];
  const used = new Set();
  for (let s of sampleRgbs) {
    if (!s) continue;
    let best=null, bestD=Infinity;
    for (let p of pool) {
      if (used.has(p.name)) continue;
      const d = colorDistanceSq(s, p.rgb);
      if (d < bestD){ best = p; bestD = d; }
    }
    if (best) { picked.push({ name: best.name, hex: best.hex }); used.add(best.name); }
  }
  // fill up to 8 with staples
  for (let p of pool) {
    if (picked.length >= 8) break;
    if (!used.has(p.name)) { picked.push({ name: p.name, hex: p.hex }); used.add(p.name); }
  }
  return picked.slice(0, 8);
}

/* ---------------------------
   Explanations & advice generation
   --------------------------- */
function generateReasonText(colorObj, skinUndertone, eyeTone, hairShade){
  const name = colorObj.name.toLowerCase();
  const reasons = [];

  // Skin undertone logic
  if (skinUndertone === 'warm') {
    if (name.includes('camel') || name.includes('dark brown') || name.includes('olive')) reasons.push('Matches your warm skin undertone and adds natural warmth.');
    else if (name.includes('navy') || name.includes('denim')) reasons.push('Provides a strong, flattering contrast to warm skin tones.');
  } else if (skinUndertone === 'cool') {
    if (name.includes('navy') || name.includes('charcoal') || name.includes('denim')) reasons.push('Complements your cool undertone and keeps looks clean and sharp.');
    else if (name.includes('stone') || name.includes('khaki') || name.includes('white')) reasons.push('Neutral tones balance cool skin with soft contrast.');
  } else {
    reasons.push('Neutral undertone — this color is a versatile staple that pairs easily with others.');
  }

  // Eye contrast
  if (eyeTone === 'blue' && name.includes('navy')) reasons.push('Navy subtly enhances blue eyes and makes them pop.');
  if (eyeTone === 'green' && (name.includes('brown') || name.includes('camel') || name.includes('olive'))) reasons.push('Earth tones bring out green in your eyes.');
  if (eyeTone === 'brown' && (name.includes('camel') || name.includes('denim') || name.includes('stone'))) reasons.push('These tones complement brown eyes for a cohesive look.');

  // Hair contrast
  if (hairShade.includes('dark') && (name.includes('camel') || name.includes('stone') || name.includes('white'))) reasons.push('A lighter accent color creates refined contrast against darker hair.');
  if (hairShade.includes('light') && (name.includes('charcoal') || name.includes('navy') || name.includes('black'))) reasons.push('Darker neutrals anchor lighter hair and provide a polished base.');

  if (reasons.length === 0) reasons.push('A reliable wardrobe staple — great for jackets, trousers and accent pieces.');

  // Combine into one or two sentences
  return reasons.join(' ');
}

function generateAdvice(skinUndertone, paletteNames){
  let jewelry = 'Neutral: both silver and gold can work; pick based on the overall outfit contrast.';
  if (skinUndertone === 'warm') jewelry = 'Gold jewelry recommended — it warms up camel and brown tones.';
  if (skinUndertone === 'cool') jewelry = 'Silver or white gold recommended — pairs well with navy and charcoal.';

  const lower = paletteNames.map(n => n.toLowerCase());
  let season = 'These staples can be used year-round with smart layering.';
  if (lower.includes('camel') || lower.includes('dark brown') || lower.includes('olive')) season = 'Autumn-forward: earthy tones (camel, brown, olive) are ideal for fall.';
  else if (lower.includes('white') || lower.includes('denim blue') || lower.includes('khaki')) season = 'Spring/Summer: lighter contrasts and denim keep looks fresh.';
  else if (lower.includes('charcoal') || lower.includes('navy') || lower.includes('black')) season = 'Winter/Urban: darker neutrals are great for layered, polished outfits.';

  const combos = [];
  if (lower.includes('navy')) combos.push('Navy blazer + white tee + camel coat or shoes.');
  if (lower.includes('denim blue') || lower.includes('khaki')) combos.push('Denim shirt + khaki chinos + olive utility jacket for a weekend look.');
  if (lower.includes('charcoal')) combos.push('Charcoal blazer + dark jeans + brown boots for smart-casual evenings.');
  if (combos.length === 0) combos.push('Navy + white + stone gray is a safe, masculine baseline.');

  return { jewelry, season, combos };
}

/* small UI role text helper */
function roleText(name){
  const n = name.toLowerCase();
  if (n.includes('navy')) return 'Great for jackets, suits & outerwear.';
  if (n.includes('charcoal') || n.includes('black')) return 'Strong base for suits & trousers.';
  if (n.includes('white')) return 'Shirts & tees — creates crisp contrast.';
  if (n.includes('camel') || n.includes('dark brown')) return 'Accents, shoes & knitwear — adds warmth.';
  if (n.includes('olive') || n.includes('khaki')) return 'Casual trousers & utility pieces.';
  if (n.includes('denim')) return 'Jeans & casual shirts.';
  if (n.includes('stone')) return 'Neutral knitwear & layering.';
  return 'Versatile wardrobe staple.';
}

/* ---------------------------
   Render palette & advice
   --------------------------- */
function renderPaletteFromAnalysis(analysis) {
  // show palette, hide upload/subscribe
  subscribeCard.style.display = 'none';
  uploadCard.style.display = 'none';
  paletteCard.style.display = 'block';
  paletteGrid.innerHTML = '';

  analysis.palette.forEach(item => {
    const card = document.createElement('div');
    card.className = 'swatch-card';
    const sample = document.createElement('div');
    sample.className = 'swatch-sample';
    sample.style.background = item.hex;

    const meta = document.createElement('div');
    meta.className = 'swatch-meta';
    const title = document.createElement('div');
    title.className = 'color-name';
    title.textContent = item.name;
    const role = document.createElement('div');
    role.className = 'color-role';
    role.textContent = roleText(item.name);
    const reason = document.createElement('div');
    reason.className = 'color-reason';
    reason.textContent = item.reason;

    meta.appendChild(title);
    meta.appendChild(role);
    meta.appendChild(reason);

    card.appendChild(sample);
    card.appendChild(meta);
    paletteGrid.appendChild(card);
  });

  comboText.textContent = analysis.advice.combos.join('  •  ');
  seasonText.textContent = analysis.advice.season;
  jewelryText.textContent = analysis.advice.jewelry;

  // store for download
  window._lastFashionPalette = analysis.palette.map(p => ({ name: p.name, hex: p.hex }));
}

/* ---------------------------
   Download palette as PNG
   --------------------------- */
downloadBtn.addEventListener('click', () => {
  const palette = window._lastFashionPalette;
  if (!palette || !palette.length) { alert('No palette ready to download.'); return; }
  const cols = Math.min(4, palette.length);
  const rows = Math.ceil(palette.length / cols);
  const sw = 300, sh = 160, pad = 20;
  const canvas = document.createElement('canvas'); canvas.width = cols*sw + pad*2; canvas.height = rows*sh + pad*2 + 60;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#0b0b0b'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font = '20px Inter, Arial'; ctx.fillStyle = '#fff'; ctx.textAlign = 'center';
  palette.forEach((p, i) => {
    const col = i % cols, row = Math.floor(i / cols);
    const x = pad + col*sw, y = pad + row*sh;
    ctx.fillStyle = p.hex; ctx.fillRect(x+10, y+10, sw-20, sh-60);
    ctx.fillStyle = '#fff'; ctx.fillText(p.name, x + sw/2, y + sh - 28);
  });
  ctx.fillStyle = '#fff'; ctx.font = '24px Inter, Arial'; ctx.fillText('Fashion Palette', canvas.width/2, canvas.height - 20);
  const link = document.createElement('a'); link.download = 'fashion-palette.png'; link.href = canvas.toDataURL('image/png'); link.click();
});

/* upload another */
uploadAnotherBtn.addEventListener('click', () => {
  paletteCard.style.display = 'none';
  // show correct section
  if (isSubscribed()) {
    uploadCard.style.display = 'block';
  } else {
    subscribeCard.style.display = 'block';
  }
  previewImage.src = '';
  previewImage.style.display = 'none';
  fileInput.value = '';
  lastAnalysis = null;
  window._lastFashionPalette = null;
});

/* ---------------------------
   Accessibility + small helpers
   --------------------------- */
uploadArea.addEventListener('keydown', (e) => {
  if ((e.key === 'Enter' || e.key === ' ') && isSubscribed()) {
    fileInput.click(); e.preventDefault();
  }
});

/* END */
</script>

</body>
</html>
