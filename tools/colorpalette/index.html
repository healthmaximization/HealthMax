<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personal Color Palette</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
/* --- Base (adapted from your uploaded index.html) --- */
:root{
  --bg1:#0F2027; --bg2:#203A43; --bg3:#2C5364;
  --panel:#1e1e1e; --muted:#a0a0a0; --accent:#28a745; --nav-bg:#1a1a1a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  font-family:'Inter',sans-serif;
  margin:0;
  padding:20px;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  background: linear-gradient(to bottom right,var(--bg1),var(--bg2),var(--bg3));
  color:#e0e0e0;
  overflow-y:auto;
}

/* subtle moving gradient */
@keyframes gradientAnimation {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
body { background-size:600% 600%; animation: gradientAnimation 20s ease infinite; }

/* Header & logo */
header { text-align:center; margin-bottom: 10px; width:100%; max-width:600px; }
.logo {
  display:block; margin:0 auto 12px auto; max-width:150px; border-radius:50%;
  object-fit:cover; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.top-stars { color:#ffd700; font-size:2.5em; margin-bottom:6px; }

h1 { font-size:2.8em; margin:6px 0; color:#f0f0f0; font-weight:700; letter-spacing:.02em; }
.subtitle { color:var(--muted); font-size:0.95em; margin-top:6px; }

/* Main nav */
.main-nav{
  background: var(--nav-bg);
  width:100%;
  max-width:600px;
  border-radius:10px;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  margin:18px 0;
  padding:12px 8px;
  display:flex;
  justify-content:space-around;
  align-items:center;
}
.main-nav a{ color:#f0f0f0; text-decoration:none; font-size:1.05em; padding:10px 16px; border-radius:8px; font-weight:500; }
.main-nav a.active{ background:#0a1a2f; color:#fff; font-weight:600; }

/* Page main container and panels */
main { width:100%; max-width:600px; display:flex; flex-direction:column; align-items:center; gap:18px; }

/* Panels (upload, results) */
.panel {
  background: var(--panel);
  padding:24px;
  border-radius:14px;
  box-shadow:0 8px 30px rgba(0,0,0,0.4);
  width:100%;
  color:#e0e0e0;
}

/* Upload area */
.upload-area {
  border:2px dashed #333;
  padding:22px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  transition:background-color .18s, border-color .18s, transform .12s;
}
.upload-area.dragover{ background-color: rgba(255,255,255,0.02); border-color:#0a1a2f; transform:translateY(-4px); }
.preview-img{ max-width:220px; max-height:220px; border-radius:12px; display:block; margin:14px auto; object-fit:cover; box-shadow:0 6px 20px rgba(0,0,0,0.5); }

/* Controls and buttons */
.controls{ display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap; }
.btn{ background:var(--accent); color:white; border:none; padding:12px 18px; border-radius:10px; font-weight:600; cursor:pointer; box-shadow:0 4px 15px rgba(40,167,69,0.35); }
.btn.secondary{ background:#0a1a2f; }
.btn:disabled{ background:#444; cursor:not-allowed; box-shadow:none; }

/* Beehiiv embed wrapper (centered) */
.embed-wrap{ display:flex; align-items:center; justify-content:center; padding:12px; min-height:280px; }
.beehiiv-embed{ display:block; margin:0 auto; width:100%; max-width:660px; height:420px; border-radius:10px !important; border:0; background:transparent; box-shadow:0 4px 15px rgba(0,0,0,0.3); }

/* Palette grid & swatches */
.palette-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:14px; margin-top:16px; }
.swatch{ background:#222; border-radius:10px; padding:12px; text-align:center; box-shadow:0 6px 20px rgba(0,0,0,0.5); }
.swatch .color{ height:80px; border-radius:8px; box-shadow: inset 0 -2px 6px rgba(0,0,0,0.3); margin-bottom:8px; border:1px solid rgba(255,255,255,0.02); }
.swatch .name{ font-weight:700; font-size:0.98em; color:#fff; }
.swatch .role{ color:var(--muted); font-size:0.9em; margin-top:6px; }

/* Advice section — stacked vertically (changed per your request) */
.advice-grid{
  display:grid;
  grid-template-columns:1fr;   /* was repeat(3,1fr) */
  gap:12px;
  margin-top:18px;
}
.advice-card{ background:linear-gradient(180deg,#0b0c0d,#0f1112); padding:14px; border-radius:10px; min-height:110px; }
.section-title{ font-weight:800; margin-bottom:8px; font-size:15px; color:#f6f7f8; }
.muted{ color:var(--muted); }

/* Footer */
footer{ margin-top:10px; color:var(--muted); font-size:13px; text-align:center; }

/* Responsive adjustments */
@media (max-width:720px){
  .palette-grid{ grid-template-columns:1fr; }
  /* advice-grid is already 1 column by default now */
  h1 { font-size:2.2em; }
  .beehiiv-embed{ height:360px; }
}

/* Added from memory */
#orientationBanner { position: fixed; top: 0; left: 0; width: 100%; background-color: #0a1a2f; /* Dark blue background */ color: #ffffff; /* White text */ text-align: center; padding: 10px 0; font-size: 1.1em; font-weight: 600; z-index: 1002; /* Higher than modal */ display: none; /* Hidden by default, shown via JS and media query */ box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); } @media (max-width: 768px) and (orientation: portrait) { #orientationBanner { display: block; } }

</style>
</head>
<body>
  <div id="orientationBanner"> Please rotate your device for the best viewing experience! </div>

  <header>
    <img class="logo" src="https://yt3.ggpht.com/6s8JL9X0gjAA2Toh9htfTY_HnaRtDTvd6cuV5U_vuAT15WTnsa07J8CHrvG6cgHkeaD25qemDA=s600-c-k-c0x00ffffff-no-rj-rp-mo" alt="Logo">
    <div class="top-stars">★★★★★</div>
    <h1>Discover Which Colors Suit You The Best</h1>
    <div class="subtitle">Upload a photo and get an AI-tailored wardrobe palette (hair, eyes, skin, and complementary accents).</div>
  </header>

  <nav class="main-nav" role="navigation" aria-label="Main Navigation">
    <a href="/">Home</a>
    <a href="/tools/" class="active">Tools</a>
    <a href="https://store.ascentimprovement.com/" target="_blank" rel="noopener">Store</a>
  </nav>

  <main>
    <section class="panel" id="interactionPanel">
      <div id="embedWrap" class="embed-wrap" aria-hidden="false" style="display:none;">
        <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
        <iframe src="https://subscribe-forms.beehiiv.com/2ec63069-4b7e-45b2-be4b-18e8c4d306d9"
                class="beehiiv-embed"
                data-test-id="beehiiv-embed"
                frameborder="0" scrolling="no"
                style="width: 767px; height: 420px; margin: 0; border-radius: 0px; background-color: transparent; box-shadow: 0 0 #0000; max-width:100%;"></iframe>
        <script type="text/javascript" async src="https://subscribe-forms.beehiiv.com/attribution.js"></script>
      </div>

      <div id="uploadPanel" style="display:none;">
        <div id="uploadArea" class="upload-area" tabindex="0" role="button" aria-label="Upload a photo">
          <strong>Upload a clear photo of your face</strong>
          <div class="muted" style="margin-top:8px;">Natural daylight works best. Analysis runs locally in your browser — nothing is uploaded to our servers.</div>
          <input id="fileInput" type="file" accept="image/*" style="display:none;">
          <img id="previewImage" class="preview-img" src="" alt="Preview" style="display:none;">
        </div>

        <div class="controls">
          <button id="analyzeBtn" class="btn" disabled>Analyze Photo</button>
          <button id="resetBtn" class="btn secondary" type="button">Reset</button>
        </div>

        <p class="muted" style="margin-top:12px;">Your personalized palette will appear below after analysis.</p>
      </div>
    </section>

    <section class="panel" id="resultsPanel" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
        <div>
          <div class="section-title">Your Personalized Fashion Palette</div>
          <div class="muted">Focused, high-impact 8-color wardrobe selection — with outfit and jewelry guidance.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="downloadBtn" class="btn">Download Palette</button>
          <button id="uploadAnotherBtn" class="btn secondary">Upload Another</button>
        </div>
      </div>

      <div id="paletteGrid" class="palette-grid" aria-live="polite"></div>

      <div class="advice-grid">
        <div class="advice-card">
          <div class="section-title">Outfit Recommendations</div>
          <div id="outfitText" class="muted"></div>
        </div>
        <div class="advice-card">
          <div class="section-title">Season Guidance</div>
          <div id="seasonText" class="muted"></div>
        </div>
        <div class="advice-card">
          <div class="section-title">Jewelry & Accessories</div>
          <div id="jewelryText" class="muted"></div>
        </div>
      </div>
    </section>

  </main>

  <footer>Private & client-side — images never leave your browser.</footer>

  <script>
  /**
   * Behavior summary:
   * - Uses localStorage key 'emailSubmitted' to gate content.
   * - If not subscribed => show Beehiiv embed (embedWrap).
   * - If subscribed => hide embed and show the upload area (uploadPanel).
   * - LARGE internal color pool (expanded) -> selects 8 output swatches per upload.
   * - Analysis runs client-side; nothing is uploaded.
   */

  // Elements
  const embedWrap = document.getElementById('embedWrap');
  const uploadPanel = document.getElementById('uploadPanel');
  const fileInput = document.getElementById('fileInput');
  const uploadArea = document.getElementById('uploadArea');
  const previewImage = document.getElementById('previewImage');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const resetBtn = document.getElementById('resetBtn');
  const resultsPanel = document.getElementById('resultsPanel');
  const paletteGrid = document.getElementById('paletteGrid');
  const downloadBtn = document.getElementById('downloadBtn');
  const uploadAnotherBtn = document.getElementById('uploadAnotherBtn');
  const outfitText = document.getElementById('outfitText');
  const seasonText = document.getElementById('seasonText');
  const jewelryText = document.getElementById('jewelryText');

  let lastAnalysis = null;
  let currentImageDataUrl = null;

  // --- VERY LARGE COLOR POOL (expanded for more personal matching) ---
  // Note: Results will pick a focused subset (DISPLAY_COUNT) from this larger set.
  const COLOR_POOL = [
    /* Core neutrals */
    {name:'Black',hex:'#0F1112'},{name:'Off-White',hex:'#F7F7F7'},{name:'White',hex:'#FFFFFF'},
    {name:'Charcoal',hex:'#2F3542'},{name:'Graphite',hex:'#1F2327'},{name:'Slate',hex:'#516275'},
    {name:'Steel Gray',hex:'#6C757D'},{name:'Ash Gray',hex:'#9AA3AA'},{name:'Light Gray',hex:'#BFC6CA'},
    {name:'Stone',hex:'#9EA3A8'},{name:'Taupe',hex:'#8D8575'},{name:'Greige',hex:'#B3ADA3'},

    /* Blues */
    {name:'Navy',hex:'#0B3D91'},{name:'Midnight Navy',hex:'#071A3A'},{name:'Deep Indigo',hex:'#14213D'},
    {name:'Steel Blue',hex:'#3A6B9A'},{name:'Denim',hex:'#2C6EB2'},{name:'Air Force Blue',hex:'#5D8AA8'},
    {name:'Slate Blue',hex:'#496A84'},{name:'Ink Blue',hex:'#12263A'},{name:'Denim Steel',hex:'#335D7E'},

    /* Greens & Teals */
    {name:'Olive',hex:'#6B8E23'},{name:'Olive Drab',hex:'#708238'},{name:'Moss',hex:'#556B2F'},
    {name:'Forest Green',hex:'#1F5D3B'},{name:'Army Green',hex:'#4B5320'},
    {name:'Deep Teal',hex:'#0E5F5D'},{name:'Forest Teal',hex:'#0D4D4A'},{name:'Petrol',hex:'#13424E'},{name:'Petrol Dark',hex:'#063A3D'},
    {name:'Sage',hex:'#7E8F7C'},{name:'Bottle Green',hex:'#0F3D2E'},

    /* Browns & Earth */
    {name:'Dark Brown',hex:'#5A381E'},{name:'Chocolate',hex:'#4B2E2A'},{name:'Espresso',hex:'#2E1B15'},
    {name:'Walnut',hex:'#6B3E2E'},{name:'Chestnut',hex:'#7E3F2A'},
    {name:'Camel',hex:'#C29B6D'},{name:'Tan',hex:'#B0895B'},{name:'Khaki',hex:'#BDB48F'},{name:'Sand',hex:'#D6C7A1'},
    {name:'Warm Beige',hex:'#CFC0A6'},{name:'Oat',hex:'#D8CBB6'},{name:'Cognac',hex:'#9E5A33'},

    /* Reds / Rust / Burgundy */
    {name:'Burgundy',hex:'#6B1E2C'},{name:'Maroon',hex:'#540B0E'},{name:'Oxblood',hex:'#4A1014'},
    {name:'Rust',hex:'#A54A24'},{name:'Burnt Orange',hex:'#A64B2A'},{name:'Copper',hex:'#8B4C2A'},{name:'Terracotta',hex:'#BA5A3C'},

    /* Metals / Accents */
    {name:'Brass',hex:'#B08B4F'},{name:'Antique Gold',hex:'#8F7A3E'},{name:'Gunmetal',hex:'#2C3539'},

    /* Extra subtle tints for shirts/knits */
    {name:'Ice Blue',hex:'#DDE7EF'},{name:'Soft Sky',hex:'#C8D8E4'},{name:'Pale Sage',hex:'#CBD7CC'},
    {name:'Bone',hex:'#E6E2D7'},{name:'Ivory',hex:'#EEE8D9'},

    /* Muted color accents (cool) */
    {name:'Bunker Blue',hex:'#0E2233'},{name:'Smoked Navy',hex:'#15293A'},{name:'Carbon Blue',hex:'#1D2A35'},
    {name:'Aegean',hex:'#3E6C86'},{name:'Cadet',hex:'#536872'},

    /* Muted color accents (warm) */
    {name:'Tobacco',hex:'#8A5A3C'},{name:'Saddle',hex:'#7C4A2A'},
    {name:'Burnished Copper',hex:'#7A3E21'},{name:'Ochre',hex:'#C28E2B'},

    /* Dark variants for depth */
    {name:'Ink',hex:'#0C1117'},{name:'Obsidian',hex:'#0B0D0F'},{name:'Smoke',hex:'#111416'}
  ];
  // Display fewer colors for results to keep it focused
  const DISPLAY_COUNT = 8; // was 12

  /* ----------------
     Gating logic: check localStorage 'emailSubmitted'
     ---------------- */
  function isSubscribed(){
    return localStorage.getItem('emailSubmitted') === 'true';
  }

  function applyGateUI(){
    const sub = isSubscribed();
    if (sub){
      embedWrap.style.display = 'none';
      uploadPanel.style.display = 'block';
    } else {
      embedWrap.style.display = 'flex';
      uploadPanel.style.display = 'none';
      resultsPanel.style.display = 'none';
    }
  }

  // If user landed on subscribe-confirmation path, set flag
  if (location.pathname === '/subscribe-confirmation') {
    try { localStorage.setItem('emailSubmitted','true'); } catch(e){}
  }

  // initial
  applyGateUI();

  // listen cross-tab
  window.addEventListener('storage', (e) => {
    if (e.key === 'emailSubmitted') applyGateUI();
  });

  // Poll fallback (1s)
  setInterval(()=>{ if (isSubscribed()) applyGateUI(); }, 900);

  /* ----------------
     Upload interactions
     ---------------- */
  uploadArea.addEventListener('click', () => {
    if (!isSubscribed()){
      embedWrap.scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }
    fileInput.click();
  });

  uploadArea.addEventListener('keydown', (e) => {
    if ((e.key === 'Enter' || e.key === ' ') && isSubscribed()) { fileInput.click(); e.preventDefault(); }
  });

  // drag & drop
  uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
  uploadArea.addEventListener('dragleave', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault(); uploadArea.classList.remove('dragover');
    if (!isSubscribed()) { embedWrap.scrollIntoView({behavior:'smooth', block:'center'}); return; }
    const f = e.dataTransfer.files && e.dataTransfer.files[0];
    if (f) handleFile(f);
  });

  fileInput.addEventListener('change', (e)=> {
    const f = e.target.files && e.target.files[0];
    if (f) handleFile(f);
  });

  function handleFile(file){
    if (!file.type.startsWith('image/')) return alert('Please upload an image file (jpg, png).');
    const reader = new FileReader();
    reader.onload = (ev) => {
      currentImageDataUrl = ev.target.result;
      previewImage.src = currentImageDataUrl;
      previewImage.style.display = 'block';
      analyzeBtn.disabled = false;
      previewImage.scrollIntoView({behavior:'smooth', block:'center'});
    };
    reader.readAsDataURL(file);
  }

  resetBtn.addEventListener('click', () => {
    previewImage.src = ''; previewImage.style.display = 'none';
    fileInput.value = ''; analyzeBtn.disabled = true;
    resultsPanel.style.display = 'none';
    lastAnalysis = null;
    currentImageDataUrl = null;
  });

  uploadAnotherBtn.addEventListener('click', () => {
    resultsPanel.style.display = 'none';
    if (isSubscribed()) uploadPanel.style.display = 'block';
    else embedWrap.style.display = 'flex';
    previewImage.style.display = 'none';
    fileInput.value = ''; analyzeBtn.disabled = true;
    lastAnalysis = null;
  });

  /* ----------------
     Client-side image analysis (simple sampling + mapping to color pool)
     - picks DISPLAY_COUNT colors for output from large pool.
     ---------------- */
  function sampleRegionAvg(ctx, box){
    const w = ctx.canvas.width, h = ctx.canvas.height;
    const x0 = Math.max(0, Math.min(w-1, box.x));
    const y0 = Math.max(0, Math.min(h-1, box.y));
    const bw = Math.max(1, Math.min(box.width, w - x0));
    const bh = Math.max(1, Math.min(box.height, h - y0));
    try {
      const data = ctx.getImageData(x0,y0,bw,bh).data;
      let r=0,g=0,b=0,count=0;
      const step = 6;
      for (let i=0;i<data.length;i+=4*step){
        const alpha = data[i+3]; if (alpha < 100) continue;
        const rr=data[i], gg=data[i+1], bb=data[i+2];
        r += rr; g += gg; b += bb; count++;
      }
      if (count===0) return {r:180,g:160,b:140};
      return { r:Math.round(r/count), g:Math.round(g/count), b:Math.round(b/count) };
    } catch(e){
      return {r:180,g:160,b:140};
    }
  }

  function rgbToHex(r,g,b){ const toHex=n=>("0"+Math.max(0,Math.min(255,Math.round(n))).toString(16)).slice(-2); return '#'+toHex(r)+toHex(g)+toHex(b); }
  function hexToRgb(h){ const s=h.replace('#',''); const v=parseInt(s,16); return {r:(v>>16)&255,g:(v>>8)&255,b:v&255}; }
  function colorDistSq(a,b){ const dr=a.r-b.r, dg=a.g-b.g, db=a.b-b.b; return dr*dr+dg*dg+db*db; }

  function analyzeImage(dataUrl){
    return new Promise((resolve,reject) => {
      const img = new Image();
      img.crossOrigin='Anonymous';
      img.onload = () => {
        // downscale
        const MAX = 600; let w=img.width,h=img.height;
        if (Math.max(w,h) > MAX) {
          if (w>h){ h=Math.round(h*MAX/w); w=MAX; } else { w=Math.round(w*MAX/h); h=MAX; }
        }
        const c = document.createElement('canvas'); c.width=w; c.height=h;
        const ctx = c.getContext('2d'); ctx.drawImage(img,0,0,w,h);

        // sample boxes (heuristic)
        const skinBox = {x:Math.round(w*0.28), y:Math.round(h*0.42), width:Math.round(w*0.44), height:Math.round(h*0.22)};
        const hairBox = {x:Math.round(w*0.15), y:0, width:Math.round(w*0.7), height:Math.round(h*0.16)};
        const eyeBox  = {x:Math.round(w*0.28), y:Math.round(h*0.3), width:Math.round(w*0.44), height:Math.round(h*0.08)};

        const skin = sampleRegionAvg(ctx, skinBox);
        const hair = sampleRegionAvg(ctx, hairBox);
        const eye  = sampleRegionAvg(ctx, eyeBox);

        // pick nearest colors from pool for each sample
        const poolRgb = COLOR_POOL.map(c=> ({...c, rgb:hexToRgb(c.hex)}));
        function nearest(rgb, usedNames){
          let best=null, bestD=Infinity;
          for (let p of poolRgb){
            if (usedNames && usedNames.has(p.name)) continue;
            const d = colorDistSq(rgb, p.rgb);
            if (d < bestD){ bestD=d; best=p; }
          }
          return best;
        }

        const used = new Set();
        const picks = [];
        const sNearest = nearest(skin, used); if (sNearest){ picks.push(sNearest); used.add(sNearest.name); }
        const hNearest = nearest(hair, used); if (hNearest){ picks.push(hNearest); used.add(hNearest.name); }
        const eNearest = nearest(eye, used);  if (eNearest){ picks.push(eNearest); used.add(eNearest.name); }

        // ensure core staples present for wardrobe usability
        const staples = ['Navy','Charcoal','Black','Off-White','White'];
        for (let st of staples){
          if (picks.length >= DISPLAY_COUNT) break;
          const f = poolRgb.find(x=>x.name===st);
          if (f && !used.has(f.name)){ picks.push(f); used.add(f.name); }
        }

        // fill up to DISPLAY_COUNT with diverse picks (earth -> cool -> accents)
        const priority = [
          'Dark Brown','Camel','Khaki','Olive','Denim','Stone','Burgundy','Forest Green','Taupe',
          'Steel Blue','Rust','Deep Teal','Petrol','Maroon','Chocolate','Tan','Sand','Brass','Copper',
          'Espresso','Slate','Greige','Sage','Air Force Blue','Bottle Green','Cognac'
        ];
        for (let pn of priority){
          if (picks.length >= DISPLAY_COUNT) break;
          const f = poolRgb.find(x=>x.name===pn);
          if (f && !used.has(f.name)){ picks.push(f); used.add(f.name); }
        }
        // if still less, add any remaining pool items
        for (let p of poolRgb){
          if (picks.length >= DISPLAY_COUNT) break;
          if (!used.has(p.name)){ picks.push(p); used.add(p.name); }
        }

        const palette = picks.slice(0, DISPLAY_COUNT).map(p => {
          const reason = generateReason(p.name.toLowerCase(), skin, eye, hair);
          return { name: p.name, hex: p.hex, reason };
        });

        resolve({skin,hair,eye,palette});
      };
      img.onerror = (e) => reject(e);
      img.src = dataUrl;
    });
  }

  // Simple heuristics for reasons (styling rationale)
  function generateReason(nameLower, skin, eye, hair){
    const reasons = [];
    if (nameLower.includes('camel') || nameLower.includes('dark brown') || nameLower.includes('rust') || nameLower.includes('cognac')){
      reasons.push('Adds warmth and pairs naturally with leather accessories.');
    }
    if (nameLower.includes('navy') || nameLower.includes('denim') || nameLower.includes('charcoal') || nameLower.includes('black')){
      reasons.push('Strong neutral that grounds outfits and pairs well with white shirts.');
    }
    if (nameLower.includes('olive') || nameLower.includes('forest') || nameLower.includes('khaki') || nameLower.includes('moss')){
      reasons.push('Earth tone that works well with casual layers and complements green/brown eyes.');
    }
    if (nameLower.includes('steel') || nameLower.includes('slate') || nameLower.includes('graphite')){
      reasons.push('Cool neutral that complements cool undertones and silver hardware.');
    }
    if (reasons.length===0) reasons.push('Versatile wardrobe staple for jackets, trousers or accents.');
    return reasons.join(' ');
  }

  /* ----------------
     Render results
     ---------------- */
  function renderPalette(analysis){
    resultsPanel.style.display = 'block';
    paletteGrid.innerHTML = '';
    analysis.palette.forEach(item=> {
      const div = document.createElement('div'); div.className = 'swatch';
      const color = document.createElement('div'); color.className='color'; color.style.background = item.hex;
      const name = document.createElement('div'); name.className='name'; name.textContent = item.name;
      const role = document.createElement('div'); role.className='role'; role.textContent = roleText(item.name);
      const reason = document.createElement('div'); reason.className='muted'; reason.style.marginTop='8px'; reason.textContent = item.reason;
      div.appendChild(color); div.appendChild(name); div.appendChild(role); div.appendChild(reason);
      paletteGrid.appendChild(div);
    });

    // Advice blocks
    outfitText.innerHTML = `
      <strong>Casual:</strong> Denim or navy chinos with khaki or camel outer layers; boots in dark brown or tan.<br><br>
      <strong>Smart-casual:</strong> Charcoal or navy blazer, white or stone knit, dark denim; brown leather accessories.<br><br>
      <strong>Formal:</strong> Charcoal or navy suit — minimal accessories; silver for cool undertones, warm leather & gold for warm undertones.
    `;
    seasonText.textContent = generateSeasonText(analysis.palette.map(p=>p.name.toLowerCase()));
    jewelryText.textContent = suggestJewelry(analysis.skin);

    // store for download
    window._lastPalette = analysis.palette.map(p=>({name:p.name,hex:p.hex}));
  }

  function roleText(name){
    const n = name.toLowerCase();
    if (n.includes('navy')) return 'Great for jackets, suits & outerwear.';
    if (n.includes('charcoal')||n.includes('black')||n.includes('graphite')) return 'Strong base for suits & trousers.';
    if (n.includes('off-white')||n.includes('white')||n.includes('sand')||n.includes('ivory')||n.includes('bone')) return 'Shirts & tees — crisp contrast.';
    if (n.includes('camel')||n.includes('tan')||n.includes('chocolate')||n.includes('cognac')) return 'Accents, shoes & knitwear — adds warmth.';
    if (n.includes('olive')||n.includes('khaki')||n.includes('forest')||n.includes('moss')) return 'Casual trousers & utility pieces.';
    if (n.includes('steel')||n.includes('slate')) return 'Outerwear and denim-friendly layers.';
    return 'Versatile wardrobe staple.';
  }

  function generateSeasonText(namesLower){
    const seasons=[];
    const spring=[], summer=[], autumn=[], winter=[];
    namesLower.forEach(n=>{
      if (n.includes('camel')||n.includes('rust')||n.includes('dark brown')||n.includes('olive')||n.includes('cognac')) autumn.push(n);
      if (n.includes('white')||n.includes('ivory')||n.includes('sand')||n.includes('denim')||n.includes('khaki')||n.includes('ice')) summer.push(n);
      if (n.includes('charcoal')||n.includes('navy')||n.includes('black')||n.includes('deep')||n.includes('steel')||n.includes('slate')) winter.push(n);
      if (n.includes('stone')||n.includes('taupe')||n.includes('sage')||n.includes('olive')||n.includes('forest')) spring.push(n);
    });
    if (spring.length) seasons.push('Spring — ' + uniqueList(spring));
    if (summer.length) seasons.push('Summer — ' + uniqueList(summer));
    if (autumn.length) seasons.push('Autumn — ' + uniqueList(autumn));
    if (winter.length) seasons.push('Winter — ' + uniqueList(winter));
    return seasons.join(' ');
  }
  function uniqueList(arr){ return Array.from(new Set(arr)).map(s=>capitalizeWords(s.replace('-',' '))).join(', '); }
  function capitalizeWords(s){ return s.split(' ').map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(' '); }

  function suggestJewelry(skin){
    // simple heuristic: warm if R-G larger, cool if B dominant
    if (skin.r - skin.g > 12) return 'Gold and warm metals (bronze, warm leather straps) will enhance warm undertones.';
    if (skin.b - skin.r > 8) return 'Silver, white gold or brushed steel suits cool undertones.';
    return 'Both silver and gold can work; choose contrast with outfit (light shirts -> darker metal, vice versa).';
  }

  /* ----------------
     Download palette as PNG
     ---------------- */
  downloadBtn.addEventListener('click', ()=> {
    const palette = window._lastPalette;
    if (!palette || !palette.length) { alert('No palette to download.'); return; }
    const cols = Math.min(4, palette.length);
    const rows = Math.ceil(palette.length/cols);
    const sw = 320, sh = 180, pad = 24;
    const canvas = document.createElement('canvas'); canvas.width = cols*sw + pad*2; canvas.height = rows*sh + pad*2 + 80;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#0d0d0d'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.font = '20px Inter, Arial'; ctx.fillStyle = '#fff'; ctx.textAlign = 'center';
    palette.forEach((p,i)=>{
      const col = i%cols, row = Math.floor(i/cols);
      const x = pad + col*sw, y = pad + row*sh;
      ctx.fillStyle = p.hex; ctx.fillRect(x+12,y+12,sw-24,sh-80);
      ctx.fillStyle = '#fff'; ctx.fillText(p.name, x + sw/2, y + sh - 34);
    });
    ctx.fillStyle = '#fff'; ctx.font = '24px Inter, Arial'; ctx.fillText('Personal Fashion Palette', canvas.width/2, canvas.height - 20);
    const a=document.createElement('a'); a.download='palette.png'; a.href=canvas.toDataURL('image/png'); a.click();
  });

  /* ----------------
     Analyze button
     ---------------- */
  analyzeBtn.addEventListener('click', async () => {
    if (!currentImageDataUrl) return alert('Please upload a photo first.');
    analyzeBtn.disabled = true;
    analyzeBtn.textContent = 'Analyzing...';
    try {
      const analysis = await analyzeImage(currentImageDataUrl);
      lastAnalysis = analysis;
      renderPalette(analysis);
      uploadPanel.style.display = 'none';
      resultsPanel.style.display = 'block';
      resultsPanel.scrollIntoView({behavior:'smooth', block:'center'});
    } catch(err){
      console.error('analysis error', err);
      alert('Analysis failed — try a different photo or lighting.');
    } finally {
      analyzeBtn.disabled = false;
      analyzeBtn.textContent = 'Analyze Photo';
    }
  });

  /* ----------------
     Init
     ---------------- */
  applyGateUI();
  </script>
  
  <script> function checkOrientationAndDisplayBanner() { const orientationBanner = document.getElementById('orientationBanner'); if (window.innerWidth <= 768 && window.innerHeight > window.innerWidth) { orientationBanner.style.display = 'block'; } else { orientationBanner.style.display = 'none'; } } window.addEventListener('resize', checkOrientationAndDisplayBanner); document.addEventListener('DOMContentLoaded', () => { checkOrientationAndDisplayBanner(); }); if ('onorientationchange' in window) { window.onorientationchange = checkOrientationAndDisplayBanner; } </script>

</body>
</html>
