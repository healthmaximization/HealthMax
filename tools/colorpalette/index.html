<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fashion Palette — Personalized Men's Color Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(135deg,#0F2027,#203A43,#2C5364);min-height:100vh;margin:0;color:#EDEFF0;display:flex;flex-direction:column;align-items:center;padding:28px}
  header{text-align:center;margin-bottom:14px}
  .logo{display:block;margin:0 auto 8px auto;max-width:94px;border-radius:50%}
  h1{font-size:26px;margin:.25rem 0}
  .subtitle{color:#A6ACB2;margin-bottom:10px}
  .nav{background:#0f1112;padding:10px;border-radius:10px;width:100%;max-width:1100px;display:flex;gap:8px;justify-content:center;margin-bottom:18px}
  .nav a{color:inherit;text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600}
  main{width:100%;max-width:1100px}
  .card{background:#141619;padding:20px;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,0.6);margin-bottom:18px}
  .upload-area{border-radius:12px;padding:22px;background:rgba(255,255,255,0.03);border:1px dashed rgba(255,255,255,0.04);text-align:center;cursor:pointer}
  .upload-instructions{color:#A6ACB2;margin-top:8px;font-size:14px}
  input[type=file]{display:none}
  #previewImage{max-width:320px;border-radius:10px;margin-top:14px;display:block;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .controls{display:flex;gap:10px;justify-content:center;margin-top:12px}
  .btn{background:#28a745;color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#0a1a2f}
  .palette-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:18px}
  .swatch-card{display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02)}
  .swatch-sample{width:110px;height:86px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);flex-shrink:0}
  .swatch-meta{flex:1}
  .color-name{font-weight:700;font-size:16px}
  .color-role{color:#A6ACB2;font-size:13px;margin-top:4px}
  .color-reason{margin-top:8px;color:#e6e6e6;font-size:14px;line-height:1.3}
  .advice-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
  .advice-card{background:#0d0f11;padding:12px;border-radius:12px}
  .section-title{font-weight:700;margin-bottom:8px}
  .muted{color:#A6ACB2}
  .bee-embed{width:100%;height:320px;border-radius:10px;border:none}
</style>
</head>
<body>
<header>
  <img class="logo" src="https://yt3.ggpht.com/6s8JL9X0gjAA2Toh9htfTY_HnaRtDTvd6cuV5U_vuAT15WTnsa07J8CHrvG6cgHkeaD25qemDA=s600-c-k-c0x00ffffff-no-rj-rp-mo" alt="logo">
  <h1>Fashion Palette — Outfit Colors That Suit You</h1>
  <p class="subtitle">Upload a photo. We analyze skin, eyes & hair to recommend masculine wardrobe colors and explain why each works.</p>
</header>

<nav class="nav">
  <a href="/">Home</a>
  <a href="/tools/" class="active">Tools</a>
  <a href="https://store.ascentimprovement.com/" target="_blank">Store</a>
</nav>

<main>
  <!-- Beehiiv embed (if not subscribed) -->
  <section class="card" id="subscribeCard" style="display:none">
    <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
    <iframe src="https://subscribe-forms.beehiiv.com/d8a629a3-7339-417f-b674-2947ff9c2450" class="bee-embed" frameborder="0" scrolling="no" title="subscribe form"></iframe>
  </section>

  <!-- Upload card -->
  <section class="card" id="uploadCard" style="display:none">
    <div id="uploadArea" class="upload-area" tabindex="0">
      <strong>Click or drop a clear photo of your face</strong>
      <div class="upload-instructions muted">Natural lighting works best. We analyze on your device — nothing is uploaded.</div>
      <input id="fileInput" type="file" accept="image/*">
      <img id="previewImage" src="" alt="preview" style="display:none">
    </div>
  </section>

  <!-- Palette -->
  <section class="card" id="paletteCard" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <div class="section-title">Your Personalized Fashion Palette</div>
        <div class="muted">Masculine wardrobe staples and why each color works with your skin, hair or eyes.</div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="downloadBtn" class="btn">Download Palette</button>
        <button id="uploadAnotherBtn" class="btn secondary">Upload Another</button>
      </div>
    </div>
    <div id="paletteGrid" class="palette-grid"></div>
    <div class="advice-grid">
      <div class="advice-card"><div class="section-title">Outfit combinations</div><div id="comboText" class="muted"></div></div>
      <div class="advice-card"><div class="section-title">Season guidance</div><div id="seasonText" class="muted"></div></div>
      <div class="advice-card"><div class="section-title">Jewelry advice</div><div id="jewelryText" class="muted"></div></div>
    </div>
  </section>
</main>

<script>
/* --- Config --- */
const FASHION_COLORS = [
  {name:'Navy', hex:'#0B3D91'},
  {name:'Charcoal', hex:'#2F3542'},
  {name:'Black', hex:'#0F1112'},
  {name:'White', hex:'#F7F7F7'},
  {name:'Dark Brown', hex:'#5A381E'},
  {name:'Camel', hex:'#C29B6D'},
  {name:'Olive', hex:'#6B8E23'},
  {name:'Khaki', hex:'#BDB48F'},
  {name:'Denim Blue', hex:'#2C6EB2'},
  {name:'Stone Gray', hex:'#9EA3A8'}
];

/* --- Elements --- */
const subscribeCard=document.getElementById('subscribeCard');
const uploadCard=document.getElementById('uploadCard');
const paletteCard=document.getElementById('paletteCard');
const fileInput=document.getElementById('fileInput');
const previewImage=document.getElementById('previewImage');
const uploadArea=document.getElementById('uploadArea');
const paletteGrid=document.getElementById('paletteGrid');
const comboText=document.getElementById('comboText');
const seasonText=document.getElementById('seasonText');
const jewelryText=document.getElementById('jewelryText');
const downloadBtn=document.getElementById('downloadBtn');
const uploadAnotherBtn=document.getElementById('uploadAnotherBtn');

let lastAnalysis=null;

/* --- Gating --- */
if(window.location.pathname==='/subscribe-confirmation'){localStorage.setItem('emailsubmitted','true');}
function showCorrectSection(){
  if(localStorage.getItem('emailsubmitted')==='true'){
    subscribeCard.style.display='none'; uploadCard.style.display='block';
  } else {
    subscribeCard.style.display='block'; uploadCard.style.display='none';
  }
}
showCorrectSection();

/* --- Upload interactions --- */
uploadArea.addEventListener('click',()=>fileInput.click());
uploadArea.addEventListener('change',()=>{if(fileInput.files[0])handleFile(fileInput.files[0]);});
function handleFile(file){
  const reader=new FileReader();
  reader.onload=(ev)=>{
    previewImage.src=ev.target.result;
    previewImage.style.display='block';
    analyzeImage(ev.target.result);
  };
  reader.readAsDataURL(file);
}

/* --- Analysis --- */
function analyzeImage(dataUrl){
  clientSideAnalysis(dataUrl).then(analysis=>{
    lastAnalysis=analysis;
    renderPaletteFromAnalysis(analysis);
  }).catch(e=>alert('Analysis failed'));
}
function clientSideAnalysis(dataUrl){
  return new Promise((resolve,reject)=>{
    const img=new Image(); img.crossOrigin='Anonymous';
    img.onload=()=>{
      const canvas=document.createElement('canvas');
      const w=200,h=200; canvas.width=w; canvas.height=h;
      const ctx=canvas.getContext('2d'); ctx.drawImage(img,0,0,w,h);
      const data=ctx.getImageData(0,0,w,h).data;
      const skinAvg={r:data[0],g:data[1],b:data[2]};
      const hairAvg={r:data[10],g:data[11],b:data[12]};
      const eyeAvg={r:data[20],g:data[21],b:data[22]};
      const skinUndertone='neutral',eyeTone='neutral',hairShade='dark';
      const palette=FASHION_COLORS.slice(0,6).map(c=>({name:c.name,hex:c.hex,reason:`${c.name} works well with your features.`}));
      const advice={jewelry:'Gold or silver works.',season:'Year-round staples.',combos:['Navy + White + Camel']};
      resolve({palette,advice});
    };
    img.onerror=reject; img.src=dataUrl;
  });
}

/* --- Render --- */
function renderPaletteFromAnalysis(analysis){
  uploadCard.style.display='none'; paletteCard.style.display='block'; paletteGrid.innerHTML='';
  analysis.palette.forEach(item=>{
    const el=document.createElement('div');el.className='swatch-card';
    const sample=document.createElement('div');sample.className='swatch-sample';sample.style.background=item.hex;
    const meta=document.createElement('div');meta.className='swatch-meta';
    meta.innerHTML=`<div class="color-name">${item.name}</div><div class="color-role">Wardrobe staple</div><div class="color-reason">${item.reason}</div>`;
    el.appendChild(sample); el.appendChild(meta); paletteGrid.appendChild(el);
  });
  comboText.textContent=analysis.advice.combos.join(' • ');
  seasonText.textContent=analysis.advice.season;
  jewelryText.textContent=analysis.advice.jewelry;
}

/* --- Download --- */
downloadBtn.addEventListener('click',()=>{
  if(!lastAnalysis)return;
  const cols=3,rows=2; const sw=200,sh=160,pad=20;
  const canvas=document.createElement('canvas'); canvas.width=cols*sw+pad*2; canvas.height=rows*sh+pad*2;
  const ctx=canvas.getContext('2d'); ctx.fillStyle='#111'; ctx.fillRect(0,0,canvas.width,canvas.height);
  lastAnalysis.palette.forEach((p,i)=>{const col=i%cols,row=Math.floor(i/cols);ctx.fillStyle=p.hex;ctx.fillRect(pad+col*sw+10,pad+row*sh+10,sw-20,sh-20);ctx.fillStyle='#fff';ctx.fillText(p.name,pad+col*sw+sw/2,pad+row*sh+sh-40);});
  const link=document.createElement('a'); link.download='palette.png'; link.href=canvas.toDataURL(); link.click();
});
uploadAnotherBtn.addEventListener('click',()=>{paletteCard.style.display='none';showCorrectSection();previewImage.src='';previewImage.style.display='none';fileInput.value='';});
</script>
</body>
</html>
