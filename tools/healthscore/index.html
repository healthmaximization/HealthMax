<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Score Quiz</title>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n 'https://www.googletagmanager.com/gtag/js?id='+i+dl;f.parentNode.insertBefore(j,f);\n })(window,document,'script','dataLayer','GTM-PJ2XGPWB');</script>
    <!-- End Google Tag Manager -->
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Favicon Link -->
    <link rel="icon" type="image/png" href="https://yt3.ggpht.com/PiQLsGmEg4FHmp-_g1Fr63bi1ZgwOx268z0D7mZPSc5FchbDllJehAL4e3hdnxyz_BiZmnn6=s600-c-k-c0x00ffffff-no-rj-rp-mo"> 

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WR8QD6X56N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WR8QD6X56N');
    </script>

    <style>
        /* General styling for the body */
        body {
            font-family: 'Inter', sans-serif;
            /* Green-blue gradient background for a luxurious feel */
            background: linear-gradient(to bottom right, #0F2027, #203A43, #2C5364);
            background-size: 600% 600%; /* Make the background much larger for smooth, subtle movement */
            animation: gradientAnimation 20s ease infinite; /* Apply animation - longer duration for smoother flow */
            color: #e0e0e0; /* Light gray text color for dark mode */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Start at the top */
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto; /* Ensure body is scrollable by default */
        }

        /* Keyframe animation for the background gradient - simplified for smoother effect */
        @keyframes gradientAnimation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Navigation bar (now empty as auth is removed) */
        .user-status-bar {
            display: none; /* Hide the entire status bar as auth is removed */
        }

        /* Styling for the main quiz container and screens */
        .quiz-container, .result-container, .start-screen {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-sizing: border-sizing;
            margin-bottom: 20px;
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out; /* For smooth transitions between screens */
        }

        /* Start Screen specific transitions */
        .start-screen.entering {
            opacity: 0;
            transform: translateX(100%);
        }
        .start-screen.entered {
            opacity: 1;
            transform: translateX(0);
        }
        .start-screen.exiting {
            opacity: 0;
            transform: translateX(-100%);
        }
        .start-screen.exited {
            opacity: 0;
            transform: translateX(-100%);
        }

        /* Quiz Container specific transitions */
        .quiz-container.entering {
            opacity: 0;
            transform: translateX(100%);
        }
        .quiz-container.entered {
            opacity: 1;
            transform: translateX(0);
        }
        .quiz-container.exiting {
            opacity: 0;
            transform: translateX(-100%);
        }
        .quiz-container.exited {
            opacity: 0;
            transform: translateX(-100%);
        }


        /* Title styling - for premium look */
        h1 {
            color: #f0f0f0;
            margin-bottom: 5px; /* Adjust margin for subtitle */
            font-size: 2.8em; /* Slightly larger for premium */
            font-weight: 700;
            letter-spacing: 0.05em; /* Add letter spacing */
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Subtle shadow */
        }

        /* Subtitle for "By HealthMax" */
        .subtitle {
            color: #a0a0a0;
            font-size: 0.9em;
            margin-top: 5px;
            margin-bottom: 20px;
            font-weight: 400;
            text-align: center; /* Ensure centered */
        }

        /* Logo placeholder styling */
        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 150px;
            height: auto;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Questions and feedback styling */
        h2 {
            color: #f0f0f0;
            margin-bottom: 25px;
            font-size: 1.5em;
            font-weight: 600;
        }

        p {
            line-height: 1.6;
            color: #c0c0c0;
            font-weight: 400;
        }

        /* Option buttons styling for multiple choice */
        .option-button {
            display: block;
            width: calc(100% - 20px);
            padding: 15px 20px;
            margin: 10px auto;
            background-color: #2a2a2a;
            color: #f0f0f0;
            border: 1px solid #444444;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            text-align: left;
        }

        .option-button:hover {
            background-color: #3a3a3a;
            transform: translateY(-2px);
            border-color: #0a1a2f;
        }

        /* Selected option animation */
        .option-button.selected {
            background-color: #0a1a2f;
            color: #ffffff;
            border-color: #0a1a2f;
            transform: scale(1.02); /* Slight pop effect */
            box-shadow: 0 4px 15px rgba(10, 26, 47, 0.6); /* Glow effect */
        }

        /* Textarea specific styling - inherits from .option-button but adds specific overrides */
        textarea.open-answer-textarea { /* Added a class for specific targeting */
            width: calc(100% - 30px); /* Adjust width to fit container with padding */
            padding: 15px;
            margin: 10px auto;
            background-color: #2a2a2a;
            color: #f0f0f0;
            border: 1px solid #444444;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 1.1em;
            resize: vertical; /* Allow vertical resizing */
            min-height: 100px; /* Minimum height */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        textarea.open-answer-textarea:focus {
            border-color: #0a1a2f; /* Highlight on focus */
            box-shadow: 0 0 0 2px #0a1a2f; /* Subtle glow on focus */
            outline: none; /* Remove default outline */
        }


        /* 'Next' button and other primary buttons styling */
        .next-button {
            background-color: #0a1a2f;
            color: #ffffff;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 30px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(10, 26, 47, 0.4);
            width: auto;
            min-width: 150px;
            margin-left: 10px;
            margin-right: 10px;
        }
        
        .next-button:hover {
            background-color: #1a2a3f;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 26, 47, 0.5);
        }

        .next-button:disabled {
            background-color: #444444;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* Score and feedback in result screen styling */
        .score-display-container {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #3a3a3a;
        }

        .score-display-container h2 {
            font-size: 2.5em;
            font-weight: 700;
            color: #f0f0f0;
            margin-bottom: 15px;
            letter-spacing: -0.02em;
        }

        .feedback-display {
            font-size: 1.15em;
            margin-bottom: 30px;
            color: #d0d0d0;
        }

        /* Utility class to hide elements */
        .hidden {
            display: none !important; /* Force hide the element */
        }

        /* Progress Bar Styling (Overall) */
        .progress-bar-container {
            width: 100%;
            max-width: 600px;
            background-color: #2a2a2a;
            border-radius: 10px;
            height: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            border-radius: 10px;
            transition: width 0.4s ease-in-out, background-color 0.4s ease-in-out;
        }

        /* Specific styling for the overall health rating progress bar fill */
        .overall-progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 10px;
            transition: width 0.4s ease-in-out, background-color 0.4s ease-in-out;
        }

        /* Specific area scores display */
        .area-scores {
            text-align: left;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #3a3a3a;
        }

        .area-scores h3 {
            color: #f0f0f0;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }

        /* Cleaned up area score item styling */
        .area-score-item {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Add transition for hover effect */
        }

        .area-score-item:hover { /* Hover effect for area score items */
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); /* Stronger shadow on hover */
        }

        .area-score-item strong {
            color: #e0e0e0;
            font-size: 1.2em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: space-between;
        }

        .area-score-item strong span {
            /* This span will now hold the raw score */
            margin-left: auto; /* Push score to the right */
            font-size: 1.2em;
            color: #e0e0e0;
            font-weight: 700;
            white-space: nowrap; /* Prevent wrapping for the score */
        }

        .area-score-item > p {
            /* This paragraph will be empty as per user request */
            display: none; /* Hide if no text is desired */
        }

        .area-progress-container {
            width: 100%;
            background-color: #3a3a3a;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .area-progress-fill {
            height: 100%;
            width: 0%;
            background-color: #28a745;
            border-radius: 8px;
            transition: width 0.6s ease-out, background-color 0.4s ease-in-out;
        }

        /* Styling for consolidated detailed recommendations */
        .recommendations-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #3a3a3a;
            text-align: left; /* Changed to left for flowing text */
        }

        .recommendations-section h3 {
            color: #f0f0f0;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 700;
            text-align: center;
        }

        /* The category headings are no longer needed if recommendations are one block */
        .recommendation-category {
            display: none; /* Hide category headings */
        }

        /* Styling for the single detailed feedback item (summary) - NOW MATCHES AREA-SCORE-ITEM */
        .detailed-feedback {
            padding: 15px 20px;
            background-color: #2a2a2a; /* Match area-score-item background */
            border-radius: 10px; /* Match area-score-item border-radius */
            text-align: left;
            font-size: 1.2em; /* Increased font size for recommendations */
            color: #d0d0d0;
            margin-bottom: 15px; /* Consistent with previous */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); /* Match area-score-item box-shadow */
            line-height: 1.5;
        }

        /* New styling for individual recommendation items */
        .recommendation-item {
            background-color: #2a2a2a; /* Match other content blocks */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            text-align: left; /* Align text to the left */
        }

        .recommendation-item h4 {
            color: #f0f0f0;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .recommendation-item p {
            font-size: 1em;
            color: #c0c0c0;
            line-height: 1.6;
        }

        /* Note on result page for more specific answers */
        .results-note {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-top: 15px;
            text-align: center;
            font-style: italic;
        }


        /* Dynamic Progress Bar Colors */
        .progress-low {
            background-color: #dc3545 !important;
        }
        .progress-medium {
            background-color: #ffc107 !important;
        }
        .progress-high {
            background-color: #28a745 !important;
        }

        /* Start Screen Styling */
        /* Removed gradient and hover transform for quiz length buttons */
        .start-screen .quiz-length-button {
            /* This will be hidden as we only have one quiz now */
            display: none;
        }

        /* Share Container and Buttons Styling */
        .share-container {
            margin-top: 30px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .share-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .share-buttons p {
            margin: 0;
            font-size: 1.1em;
            color: #e0e0e0;
            white-space: nowrap;
            font-weight: 500;
        }

        .share-button {
            background-color: #0a1a2f;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(10, 26, 47, 0.3);
        }

        .share-button:hover {
            background-color: #1a2a3f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(10, 26, 47, 0.4);
        }

        /* Restart Quiz Button Styling */
        .restart-quiz-button {
            background-color: #28a745;
            color: #ffffff;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 30px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .restart-quiz-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }

        /* Message for Copy Link */
        .copy-message {
            margin-top: 10px;
            font-size: 0.9em;
            color: #28a745;
            opacity: 0;
            transition: opacity 0.3s ease-out;
            font-weight: 500;
        }
        .copy-message.show {
            opacity: 1;
        }

        /* Loading indicator */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* This ensures it's hidden by default on page load */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.5em;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #0a1a2f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2em; /* Adjusted for smaller screens */
            }
            h2 {
                font-size: 1.3em;
            }
            .quiz-container, .result-container, .start-screen, .newsletter-gate-content { /* Changed modal target */
                padding: 20px;
            }
            .option-button, .next-button, .start-screen .quiz-length-button {
                font-size: 1em;
                padding: 12px 15px;
            }
            .start-screen .quiz-length-button span {
                font-size: 0.7em;
            }
            .area-score-item strong {
                font-size: 1.2em; /* Keep size for the emoji and category name */
            }
            .area-score-item strong span {
                font-size: 1.2em;
                margin-left: auto;
            }
            .area-score-item p {
                display: none;
            }
            .share-button {
                font-size: 0.85em;
                padding: 8px 15px;
            }
            .restart-quiz-button {
                font-size: 1.1em;
                padding: 12px 25px;
            }
            .share-buttons {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            .share-buttons p {
                white-space: normal;
            }
            .recommendations-section h3 {
                font-size: 1.4em;
            }
            .recommendation-category {
                display: none;
            }
            .detailed-feedback {
                font-size: 1.1em; /* Adjusted for smaller screens too */
            }
            .recommendation-item h4 {
                font-size: 1.2em;
            }
            .recommendation-item p {
                font-size: 0.95em;
            }

            /* Testimonial adjustments for mobile */
            .testimonial-card {
                padding: 15px;
            }
            .testimonial-card p {
                font-size: 0.9em;
            }
            .testimonial-card .stars {
                font-size: 1.3em;
            }
             .top-stars {
                font-size: 1.8em; /* Adjust for smaller screens */
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2em; /* Further adjustment for small phones */
            }
            h2 {
                font-size: 1.1em;
            }
            .option-button {
                padding: 10px 15px;
            }
            .next-button {
                padding: 10px 20px;
            }
            .start-screen .quiz-length-button {
                font-size: 1em;
                padding: 12px 20px;
            }
            .share-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .share-button {
                width: 100%;
                max-width: none;
            }
            .score-display-container h2 {
                font-size: 2em;
            }
            .feedback-display {
                font-size: 1em;
            }
            .recommendations-section h3 {
                font-size: 1.2em;
            }
            .recommendation-category {
                display: none;
            }
            .detailed-feedback {
                font-size: 1em; /* Adjusted for smallest screens too */
            }
            .recommendation-item h4 {
                font-size: 1.1em;
            }
            .recommendation-item p {
                font-size: 0.85em;
            }
             .top-stars {
                font-size: 1.6em; /* Adjust for smallest screens */
            }
        }

        /* New styles for testimonials */
        .testimonials-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #3a3a3a;
            text-align: center;
            width: 100%; /* Ensure it spans the container width */
        }

        .testimonials-section h3 {
            color: #f0f0f0;
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 700;
        }

        .testimonial-card {
            background-color: #2a2a2a; /* Match other content blocks */
            padding: 20px;
            border-radius: 10px;
            /* Enhanced styling for premium look */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05) inset; /* Deeper shadow and subtle inset border */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition */
            margin-bottom: 20px;
            text-align: center;
            display: flex; /* Use flexbox to align icon and text */
            flex-direction: column;
            align-items: center;
        }

        .testimonial-card:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7), 0 0 0 2px rgba(255, 255, 255, 0.1) inset; /* Stronger shadow and border on hover */
        }

        .testimonial-card p {
            font-size: 1em;
            color: #c0c0c0;
            margin-bottom: 10px;
        }

        .testimonial-card .stars {
            color: #ffd700; /* Gold color for stars */
            font-size: 1.5em;
            margin-bottom: 10px;
            letter-spacing: 2px; /* Space out stars a bit */
        }

        .testimonial-card .author-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            gap: 8px; /* Space between icon and name */
        }

        .author-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em; /* Size of the initial/emoji inside the circle */
            color: #ffffff; /* Color of the initial/emoji */
            font-weight: 600;
        }

        .author-icon svg {
            width: 60%; /* Make SVG fill the circle */
            height: 60%; /* Make SVG fill the circle */
            fill: currentColor; /* Inherit color from parent (author-icon) */
        }

        /* Specific colors for icons */
        .icon-blue { background-color: #3498db; }
        .icon-green { background-color: #2ecc71; }
        .icon-purple { background-color: #9b59b6; }
        .icon-orange { background-color: #e67e22; }


        /* New Lead Magnet Section on Results Page */
        .lead-magnet-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #3a3a3a;
            text-align: center;
            width: 100%;
        }

        .lead-magnet-section h3 {
            color: #f0f0f0;
            margin-bottom: 15px;
            font-size: 1.8em;
            font-weight: 700;
        }

        .lead-magnet-section p {
            font-size: 1.1em;
            color: #c0c0c0;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* Adjust iframe for responsiveness within its container */
        .lead-magnet-section iframe {
            width: 100%; /* Make iframe responsive */
            max-width: 660px; /* Keep original max-width */
            height: 412px; /* Maintain original height */
        }

        /* New: Top 5-star rating */
        .top-stars {
            color: #ffd700; /* Gold color for stars */
            font-size: 2.5em; /* Large size */
            margin-bottom: 10px;
            letter-spacing: 3px; /* More spacing for prominence */
            animation: pulse 1.5s infinite alternate; /* Subtle pulse animation */
            text-align: center;
            width: 100%; /* Take full width to center */
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.05); opacity: 0.9; }
        }

        /* Specific styling for the Start Quiz Button */
        #startQuizBtn {
            background-color: #28a745; /* A vibrant green */
            background-image: linear-gradient(to right, #28a745, #218838); /* Subtle gradient for depth */
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6), 0 0 30px rgba(40, 167, 69, 0.4); /* Green glow */
            color: #ffffff;
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            margin: 15px auto;
            width: calc(100% - 20px);
            max-width: 350px;
            display: block;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); /* Text shadow for better contrast */
        }

        #startQuizBtn:hover {
            background-color: #218838; /* Darker green on hover */
            background-image: linear-gradient(to right, #218838, #28a745); /* Reversed gradient on hover */
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.8), 0 0 40px rgba(40, 167, 69, 0.5); /* Stronger glow */
            transform: translateY(-3px); /* Lift effect */
        }

        /* Styling for the AI-Powered text and icon */
        .ai-powered-tag {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: -10px; /* Adjust to position correctly below title */
            margin-bottom: 20px;
            color: #8c8c8c; /* Slightly darker than subtitle */
            font-size: 0.95em;
            font-weight: 500;
        }

        .ai-powered-tag svg {
            width: 20px;
            height: 20px;
            fill: #ffd700; /* Gold color for the icon */
        }

        /* New style for the tip during open-ended questions */
        .tip-message {
            margin-top: 15px;
            font-size: 0.9em;
            color: #b0b0b0; /* Light grey for subtle tip */
            font-style: italic;
        }

        /* New styles for Benefits Section */
        .benefits-section {
            margin-top: 30px;
            margin-bottom: 40px;
            padding: 25px;
            background-color: #2a2a2a;
            border-radius: 15px;
            /* Enhanced styling for premium look, similar to testimonials */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05) inset; /* Deeper shadow and subtle inset border */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition */
            text-align: left;
        }

        .benefits-section:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7), 0 0 0 2px rgba(255, 255, 255, 0.1) inset; /* Stronger shadow and border on hover */
        }

        .benefits-section h3 {
            color: #f0f0f0;
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .benefits-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .benefits-section li {
            display: flex; /* Use flexbox for better icon/text alignment */
            align-items: flex-start; /* Align items to the top */
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #d0d0d0;
            line-height: 1.4;
        }

        /* New style for emoji icons within list items */
        .benefits-section li .icon-emoji {
            font-size: 1.4em; /* Make emoji slightly larger than text */
            line-height: 1;   /* Ensure emoji aligns properly on the line */
            margin-right: 8px; /* Space between emoji and text */
            min-width: 1.4em; /* Prevent text shifting with different emojis */
            text-align: center; /* Center emoji within its minimum width */
            color: #ffd700; /* Optional: give emoji a specific color, e.g., gold */
        }

        /* Style for normal text within list items (no extra bold) */
        .benefits-section li span.normal-text {
            font-weight: normal; /* Ensure text is not bold */
            color: inherit; /* Inherit color from parent (li) */
        }

        /* Styling for the main navigation */
        .main-nav {
            background-color: #1a1a1a;
            width: 100%;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            padding: 15px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .main-nav a {
            color: #f0f0f0;
            text-decoration: none;
            font-size: 1.1em;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .main-nav a:hover {
            background-color: #0a1a2f;
            color: #ffffff;
        }
        
        .main-nav a.active {
            background-color: #0a1a2f;
            color: #ffffff;
            font-weight: 600;
        }

        @media (max-width: 480px) {
            .main-nav { 
                flex-direction: column; 
                gap: 10px; 
            }
            .main-nav a { 
                width: calc(100% - 40px); /* Adjust width for full mobile width with padding */
            }
        }

        /* New styles for the Newsletter Gate Modal */
        .newsletter-gate-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Semi-transparent background with blur effect */
            background-color: rgba(0, 0, 0, 0.65); 
            backdrop-filter: blur(10px); /* Stronger blur effect */
            -webkit-backdrop-filter: blur(10px); /* For Safari */
            display: flex;
            flex-direction: column; /* Changed to column for logo and content stacking */
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Higher than loading overlay */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out; /* Smoother transition */
            padding: 20px; 
            box-sizing: border-box;
        }

        .newsletter-gate-modal.visible {
            opacity: 1;
            visibility: visible;
        }

        /* New: Logo above the popup */
        .newsletter-gate-modal .logo-modal-top {
            display: block;
            max-width: 120px; 
            height: auto;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5); 
            border: 4px solid #0a1a2f; 
            z-index: 10; 
            margin-bottom: -60px; /* Pull the content up */
        }

        .newsletter-gate-content {
            background-color: #1e1e1e;
            padding: 25px; /* More padding for a roomier look */
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.1) inset; /* Deeper shadow and subtle inset border */
            max-width: 700px; /* Increased max-width for better fit of Beehiiv embed */
            width: 90%; 
            text-align: center;
            box-sizing: border-box;
            transform: translateY(20px); 
            transition: transform 0.4s ease-out; 
            position: relative; 
            overflow: visible; 
            overflow-x: hidden; /* Prevent horizontal scrollbar on the modal content itself */
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: flex-start; 
            
            padding-top: 85px; /* Adjust padding-top to make space for the overlapping logo */
        }
        
        .newsletter-gate-modal.visible .newsletter-gate-content {
            transform: translateY(0); /* Slide up to final position */
        }

        .newsletter-gate-content .beehiiv-embed {
            margin: 0 auto; 
            width: 100%; 
            max-width: 660px; 
            height: auto; 
            min-height: 280px; 
            border: none; 
            border-radius: 10px !important; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
            background-color: transparent;
        }
        
        .newsletter-gate-content .terms-checkbox {
            display: none; /* Hide the checkbox as per new logic */
        }

        .newsletter-gate-content button {
            background-color: #28a745;
            color: #ffffff;
            padding: 12px 25px; 
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em; 
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
            width: auto;
            min-width: 180px; 
            margin-top: 25px; /* Add margin since checkbox is removed */
        }

        .newsletter-gate-content button:hover:not(:disabled) {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }

        .newsletter-gate-content button:disabled {
            background-color: #444444;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* Responsive adjustments for the popup */
        @media (max-width: 480px) {
            .newsletter-gate-content {
                padding: 15px; 
                max-width: 95%; 
                padding-top: 60px; /* Adjust padding for smaller logo on mobile */
            }
            .newsletter-gate-content button {
                padding: 10px 20px; 
                font-size: 1em; 
            }
            .newsletter-gate-modal .logo-modal-top {
                max-width: 80px; 
                margin-bottom: -40px; /* Adjust for smaller size */
            }
            .newsletter-gate-content .terms-checkbox {
                font-size: 0.8em; 
            }
        }

        /* Styling for the emphasized 'Free' text */
        .highlight-free {
            font-weight: 800; 
            text-transform: uppercase; 
            color: #ffd700; 
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5); 
            animation: pulse-free 2s infinite alternate; 
        }
        
        /* Keyframe animation for the 'Free' pulse */
        @keyframes pulse-free {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.03); opacity: 0.95; }
        }

        .intro-text p strong {
            font-weight: 700;
        }

        /* New: Orientation Banner for Mobile */
        #orientationBanner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #0a1a2f; /* Dark blue background */
            color: #ffffff; /* White text */
            text-align: center;
            padding: 10px 0;
            font-size: 1.1em;
            font-weight: 600;
            z-index: 1002; /* Higher than modal */
            display: none; /* Hidden by default, shown via JS and media query */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        /* Show banner only on mobile in portrait */
        @media (max-width: 768px) and (orientation: portrait) {
            #orientationBanner {
                display: block;
            }
        }

        /* Styles for The Morning Protocol Offer Section */
        .product-offer-section {
            margin-top: 50px;
            padding: 35px;
            background-color: #1e1e1e; /* Same as quiz container */
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6), 0 0 0 2px rgba(255, 255, 255, 0.08) inset; /* Stronger shadow, subtle inset */
            text-align: center;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-offer-section:hover {
            transform: translateY(-8px); /* More pronounced lift */
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8), 0 0 0 3px rgba(255, 255, 255, 0.1) inset; /* Even stronger shadow */
        }

        .offer-headline {
            color: #ffd700; /* Gold for prominence */
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.3;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
        }

        .offer-intro, .offer-problem, .offer-solution, .offer-value, .cta-note {
            color: #d0d0d0;
            font-size: 1.1em;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        /* Apply gold color to strong tags within this section */
        .product-offer-section strong {
            color: #ffd700; /* Gold color for emphasized text within the offer */
            font-weight: 700; /* Ensure it's bold */
        }

        .product-image-container {
            margin: 30px auto;
            max-width: 300px; /* Adjust as needed for image size */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .product-image-container:hover {
            transform: scale(1.03);
        }

        .product-cover-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 10px;
        }

        .benefits-list {
            text-align: left;
            margin-top: 30px;
            margin-bottom: 30px;
            background-color: #2a2a2a;
            padding: 25px;
            border-radius: 12px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .benefits-list h4 {
            color: #f0f0f0;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .benefits-list ul {
            list-style: none;
            padding: 0;
        }

        .benefits-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            font-size: 1.05em;
            color: #c0c0c0;
            line-height: 1.5;
        }

        .bullet-icon {
            font-size: 1.3em;
            color: #28a745; /* Green checkmark */
            margin-right: 10px;
            min-width: 1.3em; /* Ensure icon doesn't shift text */
        }

        .offer-details {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 25px;
            background-color: #2a2a2a;
            border-radius: 12px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .original-price {
            font-size: 1.3em;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .strike-through {
            text-decoration: line-through;
            font-weight: 500;
        }

        .special-price {
            font-size: 2.5em;
            font-weight: 900;
            color: #28a745; /* Vibrant green for the special price */
            margin-top: 5px;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(40, 167, 69, 0.7); /* Glow effect */
        }

        .highlight-price {
            animation: pricePulse 1.5s infinite alternate; /* Subtle pulse for the price */
        }

        @keyframes pricePulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.05); opacity: 0.9; }
        }

        .coupon-info {
            font-size: 1.15em;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .coupon-code {
            font-weight: 700;
            color: #ffd700; /* Gold for coupon code */
            background-color: #3a3a3a;
            padding: 5px 10px;
            border-radius: 5px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .urgency-scarcity {
            font-size: 1.2em;
            color: #dc3545; /* Red for urgency */
            font-weight: 700;
            margin-top: 20px;
            padding: 10px;
            border: 2px solid #dc3545;
            border-radius: 8px;
            animation: pulse-urgency 1s infinite alternate;
        }

        @keyframes pulse-urgency {
            0% { border-color: #dc3545; color: #dc3545; transform: scale(1); }
            100% { border-color: #ff6b6b; color: #ff6b6b; transform: scale(1.02); }
        }

        .cta-button {
            background-color: #ffd700; /* Gold CTA button */
            background-image: linear-gradient(to right, #ffd700, #ffcc00);
            color: #1e1e1e; /* Dark text for contrast */
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.4em;
            font-weight: 800;
            text-decoration: none;
            display: inline-block;
            margin-top: 30px;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .cta-button:hover {
            background-color: #ffcc00;
            background-image: linear-gradient(to right, #ffcc00, #ffd700);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.7);
        }

        @media (max-width: 480px) {
            .product-offer-section {
                padding: 25px;
            }
            .offer-headline {
                font-size: 1.6em;
            }
            .offer-intro, .offer-problem, .offer-solution, .offer-value, .cta-note {
                font-size: 1em;
            }
            .benefits-list h4 {
                font-size: 1.2em;
            }
            .benefits-list li {
                font-size: 0.95em;
            }
            .special-price {
                font-size: 2em;
            }
            .original-price, .coupon-info, .urgency-scarcity {
                font-size: 1em;
            }
            .cta-button {
                font-size: 1.2em;
                padding: 15px 25px;
            }
        }

    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PJ2XGPWB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- New: Orientation Banner for Mobile -->
    <div id="orientationBanner">
        Please rotate your phone for the best experience! ðŸ“±
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p id="loadingMessage">Finalizing your personalized results with AI...</p>
    </div>

    <!-- Newsletter Gate Modal (Hidden by default) -->
    <div id="newsletterGateModal" class="newsletter-gate-modal">
        <!-- HealthMax logo, now a direct sibling to newsletter-gate-content -->
        <img src="https://yt3.ggpht.com/PiQLsGmEg4FHmp-_g1Fr63bi1ZgwOx268z0D7mZPSc5FchbDllJehAL4e3hdnxyz_BiZmnn6=s600-c-k-c0x00ffffff-no-rj-rp-mo" alt="HealthMax Logo" class="logo-modal-top">
        <div class="newsletter-gate-content">
            <!-- Removed fixed title and description, as Beehiiv embed handles its own text -->
            <!-- START BEEHIIV FORM CODE -->
            <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script><iframe src="https://subscribe-forms.beehiiv.com/d8a629a3-7339-417f-b674-2947ff9c2450" class="beehiiv-embed" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="width: 100%; height: auto; min-height: 280px; margin: 0 auto; border-radius: 10px !important; background-color: transparent; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); max-width: 660px;"></iframe>
            <!-- END BEEHIIV FORM CODE -->

            <!-- De checkbox en de bijbehorende tekst zijn verwijderd, zoals gevraagd. -->
            <button id="viewResultsButton" disabled>View My Results</button>
        </div>
    </div>

    <header>
        <!-- Place your logo URL here -->
        <img src="https://yt3.ggpht.com/PiQLsGmEg4FHmp-_g1Fr63bi1ZgwOx268z0D7mZPSc5FchbDllJehAL4e3hdnxyz_BiZmnn6=s600-c-k-c0x00ffffff-no-rj-rp-mo" alt="HealthMax Logo" class="logo">
        <div class="top-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div> <!-- New 5-star rating -->
        <!-- Updated H1: Problem-focused, engaging -->
        <h1>Are You REALLY Healthy?</h1>
        <!-- Updated subtitle: Benefit-driven, action-oriented -->
        <p class="subtitle">Discover Your REAL Health Score & Unlock Your Potential!</p>
        <!-- AI-Powered tag with Gemini-like icon -->
        <div class="ai-powered-tag">
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2.92 14.5c-.32.32-.86.32-1.18 0l-2.48-2.48c-.32-.32-.32-.86 0-1.18l2.48-2.48c.32-.32.86-.32 1.18 0l2.48 2.48c.32.32.32.86 0 1.18l-2.48 2.48zm8.92-8.5c-.32-.32-.86-.32-1.18 0L12 12.08l-2.48-2.48c-.32-.32-.86-.32-1.18 0s-.32.86 0 1.18l3.07 3.07c.32.32.86.32 1.18 0l3.07-3.07c.32-.32.32-.86 0-1.18z"/>
            </svg>
            <span>AI-Powered Insights</span>
        </div>
    </header>

    <nav class="main-nav">
        <a href="/">Home</a>
        <a href="/tools/" class="active">Tools</a> <!-- Aangepast naar /tools/overview -->
        <a href="https://store.healthmaximization.com/" target="_blank">Store</a> <!-- Newly added: Store tab -->
    </nav>

    <main>
        <!-- User Status Bar - Entirely removed as authentication is removed -->

        <!-- Start Screen (visible by default) -->
        <div id="startScreen" class="start-screen entered">
            <div class="intro-text">
                <!-- Updated H2: More impactful and action-oriented -->
                <h2>Stop guessing. Discover the TRUTH about your health now!</h2>
                <!-- Adjusted emphasis on free: no stars, 'FREE' in uppercase and extra bold, with subtle shadow -->
                <p>Discover your personal and accurate health analysis. This <span class="highlight-free">FREE</span> quiz gives you clarity in minutes, evaluating your nutrition, exercise, sleep, and mental well-being.</p>
            </div>

            <button id="startQuizBtn" class="next-button">Discover My Score Now!</button>

            <!-- New Benefits Section -->
            <div class="benefits-section">
                <h3>Why take your Health Score Quiz?</h3>
                <ul>
                    <li><span class="icon-emoji">ðŸ’¡</span> <span class="normal-text">Get truly personalized insights into your unique health profile.</span></li>
                    <li><span class="icon-emoji">ðŸ“ˆ</span> <span class="normal-text">Receive actionable steps and concrete advice for improvement.</span></li>
                    <!-- Emphasis on free in the benefits section, with new class -->
                    <li><span class="icon-emoji">âœ…</span> <span class="normal-text">Enjoy a <span class="highlight-free">FREE</span> analysis with no hidden costs.</span></li>
                    <li><span class="icon-emoji">ðŸš€</span> <span class="normal-text">It's quick and easy, providing results in just a few minutes.</span></li>
                </ul>
            </div>

            <!-- Testimonials Section -->
            <div class="testimonials-section">
                <h3>What People Are Saying About HealthMax</h3>
                <div class="testimonial-card">
                    <p>"This quiz gave me such clear insights! It's beautifully designed and genuinely helpful. My health journey feels much clearer now."</p>
                    <div class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>
                    <div class="author-container">
                        <span class="author-icon icon-blue">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 4C14.21 4 16 5.79 16 8C16 10.21 14.21 12 12 12C9.79 12 8 10.21 8 8C8 5.79 9.79 4 12 4ZM12 14C16.42 14 20 15.79 20 20V22H4V20C4 15.79 7.58 14 12 14Z" fill="currentColor"/>
                            </svg>
                        </span>
                        <p class="author">- Sarah L.</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p>"A truly premium experience. The personalized recommendations are spot on and actionable. Highly recommended!"</p>
                    <div class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>
                    <div class="author-container">
                        <span class="author-icon icon-green">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 4C14.21 4 16 5.79 16 8C16 10.21 14.21 12 12 12C9.79 12 8 10.21 8 8C8 5.79 9.79 4 12 4ZM12 14C16.42 14 20 15.79 20 20V22H4V20C4 15.79 7.58 14 12 14Z" fill="currentColor"/>
                            </svg>
                        </span>
                        <p class="author">- Mark T.</p>
                    </div>
                </div>
            </div>
            <!-- Removed Beehiiv Email Form from Start Screen -->
        </div>

        <!-- Progress Bar Container (Overall quiz progress) -->
        <div class="progress-bar-container hidden">
            <div id="progressBarFill" class="progress-bar-fill"></div>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container hidden">
            <h2 id="questionDisplay"></h2>
            <div id="optionsContainer" class="options-container">
                <!-- Question options (buttons or textarea) will be dynamically added here by JavaScript -->
            </div>
            <p id="quizTip" class="tip-message hidden">Tip: The more detailed your answers, the better your personalized analysis!</p>
            <button id="nextButton" class="next-button" disabled>Next</button>
        </div>

        <!-- Result Container (initially hidden) -->
        <div id="resultContainer" class="result-container hidden">
            <div class="score-display-container">
                <h2 id="overallScoreDisplay">Your Overall Health Score</h2>
                <div class="progress-bar-container">
                    <div id="overallProgressBarFill" class="overall-progress-fill"></div>
                </div>
            </div>
            <p class="feedback-display"></p>

            <div class="area-scores">
                <h3>Your Scores by Area:</h3>
                <div id="nutritionScore" class="area-score-item">
                    <strong>ðŸŽ Nutrition<span id="nutritionPoints"></span></strong>
                    <div class="area-progress-container">
                        <div id="nutritionProgressBarFill" class="area-progress-fill"></div>
                    </div>
                </div>
                <div id="exerciseScore" class="area-score-item">
                    <strong>ðŸƒâ€â™‚ï¸ Exercise<span id="exercisePoints"></span></strong>
                    <div class="area-progress-container">
                        <div id="exerciseProgressBarFill" class="area-progress-fill"></div>
                    </div>
                </div>
                <div id="sleepScore" class="area-score-item">
                    <strong>ðŸ˜´ Sleep<span id="sleepPoints"></span></strong>
                    <div class="area-progress-container">
                        <div id="sleepProgressBarFill" class="area-progress-fill"></div>
                    </div>
                </div>
                <div id="mentalScore" class="area-score-item">
                    <strong>ðŸ§  Mental Well-being<span id="mentalPoints"></span></strong>
                    <div class="area-progress-container">
                        <div id="mentalProgressBarFill" class="area-progress-fill"></div>
                    </div>
                </div>
            </div>

            <div class="share-container">
                <div class="share-buttons">
                    <p>Share your results!</p>
                    <button id="copyLinkBtn" class="share-button">Copy Link</button>
                </div>
                <div id="copyMessage" class="copy-message">Link copied!</div>
            </div>

            <button id="restartQuizBtn" class="restart-quiz-button">Retake Quiz</button>

            <!-- Consolidated Recommendations Section -->
            <div id="allDetailedRecommendations" class="recommendations-section">
                <h3>Our Personalized Recommendations</h3>
                <!-- Detailed feedback items will be appended here by JavaScript -->
                <p class="results-note">Not satisfied with your recommendations? Try the quiz again and be more specific about your challenges to get even better insights!</p>
            </div>

            <!-- New: The Morning Protocol Offer Section -->
            <div id="morningProtocolOffer" class="product-offer-section">
                <h3 class="offer-headline">Unlock Your Peak Performance: The ONLY Morning Routine You'll Ever Need.</h3>
                <p class="offer-intro">Your personalized health score is a powerful snapshot of your current well-being. But what if you could take it a step further?</p>
                <p class="offer-problem">Are you tired of hitting snooze? Do you struggle with brain fog, low energy, or feeling overwhelmed before your day even begins?</p>

                <div class="product-image-container">
                    <img src="https://public-files.gumroad.com/xz4symwybt89n2jsz9p3f3q7iia5" alt="The Morning Protocol E-book Cover" class="product-cover-image">
                </div>

                <p class="offer-solution">Imagine a life where you effortlessly tackle your goals, radiate positive energy, and achieve more before lunch than most people do all day. This isn't a pipe dream. It's the reality for thousands who've leveraged the power of a <em>structured, intentional morning routine</em>.</p>

                <div class="benefits-list">
                    <h4>With The Morning Protocol, you will:</h4>
                    <ul>
                        <li><span class="bullet-icon">&#10003;</span> Skyrocket your energy levels from the moment you open your eyes.</li>
                        <li><span class="bullet-icon">&#10003;</span> Crush procrastination and build unstoppable momentum.</li>
                        <li><span class="bullet-icon">&#10003;</span> Sharpen your focus and clarity throughout the day.</li>
                        <li><span class="bullet-icon">&#10003;</span> Reduce stress and cultivate a powerful, positive mindset.</li>
                        <li><span class="bullet-icon">&#10003;</span> Achieve more in your life, both personally and professionally.</li>
                    </ul>
                </div>

                <p class="offer-value">This isn't a complex, theoretical tome. It's a <strong>concise, actionable system</strong> designed for <em>immediate results</em>.</p>

                <div class="offer-details">
                    <p class="original-price">Normally: <span class="strike-through">$18</span></p>
                    <p class="special-price">YOUR SPECIAL PRICE: <span class="highlight-price">$9!</span></p>
                    <p class="coupon-info">Use coupon code: <span class="coupon-code">TMP50</span> at checkout for 50% OFF!</p>
                    <p class="urgency-scarcity">ðŸ”¥ <strong>Limited Time Offer!</strong> Only available for the <strong>first 10 customers!</strong> Don't miss out on this exclusive opportunity to redefine your mornings.</p>
                </div>

                <a href="https://store.healthmaximization.com/l/themorningprotocol" target="_blank" class="cta-button">
                    Get The Morning Protocol Now!
                </a>
                <p class="cta-note">Click the button above to secure your copy and claim your discount.</p>
            </div>
            <!-- End: The Morning Protocol Offer Section -->

        </div>
    </main>
    
    <!-- Hidden input for clipboard operations - positioned here to avoid dynamic DOM manipulation issues -->
    <input type="text" id="shareLinkInput" style="position: absolute; left: -9999px; top: -9999px; opacity: 0;">

    <script type="module">
        // Define questions for each category, now multiple-choice first, then open-ended
        const healthCategories = [
            {
                name: "nutrition",
                questions: [
                    {
                        question: "How many servings of fruits and vegetables do you typically consume per day?",
                        type: "multiple-choice",
                        options: [
                            { text: "0-1 serving", score: 5 },
                            { text: "2-3 servings", score: 10 },
                            { text: "4-5 servings", score: 15 },
                            { text: "6+ servings", score: 20 }
                        ]
                    },
                    {
                        question: "Please share your typical daily eating habits, including meals, snacks, and beverages. Feel free to mention any challenges or effects on your energy and mood.",
                        type: "open-text",
                        maxPoints: 25 
                    }
                ]
            },
            {
                name: "exercise",
                questions: [
                    {
                        question: "How many days per week do you engage in moderate to intense physical activity (e.g., brisk walking, jogging, sports) for at least 30 minutes?",
                        type: "multiple-choice",
                        options: [
                            { text: "0 days", score: 5 },
                            { text: "1-2 days", score: 10 },
                            { text: "3-4 days", score: 15 },
                            { text: "5+ days", score: 20 }
                        ]
                    },
                    {
                        question: "Tell us about your physical activity: How do you typically move, what are any obstacles, and what motivates you to stay active?",
                        type: "open-text",
                        maxPoints: 25 
                    }
                ]
            },
            {
                name: "sleep",
                questions: [
                    {
                        question: "On average, how many hours of restful sleep do you get per night?",
                        type: "multiple-choice",
                        options: [
                            { text: "Less than 5 hours", score: 5 },
                            { text: "5-6 hours", score: 10 },
                            { text: "7-8 hours", score: 20 },
                            { text: "More than 9 hours", score: 15 }
                        ]
                    },
                    {
                        question: "Please describe your sleep habits: What's your evening winding-down routine, what helps or hinders your sleep, and what are your biggest challenges for restful sleep?",
                        type: "open-text",
                        maxPoints: 25 
                    }
                ]
            },
            {
                name: "mental",
                questions: [
                    {
                        question: "How often do you feel overwhelmed or highly stressed in a typical week?",
                        type: "multiple-choice",
                        options: [
                            { text: "Rarely", score: 20 },
                            { text: "Sometimes", score: 15 },
                            { text: "Often", score: 10 },
                            { text: "Most of the time", score: 5 }
                        ]
                    },
                    {
                        question: "Please share your approach to mental well-being: What practices do you use to manage stress, and what aspect of your mental health needs the most attention? Please name your biggest challenges.",
                        type: "open-text",
                        maxPoints: 25 
                    }
                ]
            }
        ];

        // Flatten the questions for sequential display
        let currentQuestions = [];
        healthCategories.forEach(category => {
            category.questions.forEach(q => {
                currentQuestions.push({ ...q, category: category.name });
            });
        });

        // Quiz state variables
        let currentQuestionIndex = 0;
        let userScores = {
            nutrition: 0,
            exercise: 0,
            sleep: 0,
            mental: 0
        };
        let maxPossibleScores = {
            nutrition: 0,
            exercise: 0,
            sleep: 0,
            mental: 0
        };
        let userFeedback = {
            nutrition: [], 
            exercise: [],
            sleep: [],
            mental: []
        };
        let selectedOption = null; // To track selected option for multiple choice
        let hasTriggeredNewsletterModal = false; // New flag to control modal display
        let pendingAiScorePromises = []; // Array to hold promises for background AI scoring

        // DOM elements
        const startScreen = document.getElementById('startScreen');
        const quizContainer = document.getElementById('quizContainer');
        const resultContainer = document.getElementById('resultContainer');
        const newsletterGateModal = document.getElementById('newsletterGateModal'); // New modal element
        // const subscribedConfirmCheckbox = document.getElementById('subscribedConfirm'); // Verwijderd
        const viewResultsButton = document.getElementById('viewResultsButton'); // New button
        const questionDisplay = document.getElementById('questionDisplay');
        const optionsContainer = document.getElementById('optionsContainer'); 
        const nextButton = document.getElementById('nextButton');
        const progressBarFill = document.getElementById('progressBarFill');
        const overallProgressBarFill = document.getElementById('overallProgressBarFill');
        const overallScoreDisplay = document.getElementById('overallScoreDisplay');
        const feedbackDisplay = document.querySelector('.feedback-display');
        const nutritionPointsSpan = document.getElementById('nutritionPoints');
        const exercisePointsSpan = document.getElementById('exercisePoints');
        const sleepPointsSpan = document.getElementById('sleepPoints');
        const sleepProgressBarFill = document.getElementById('sleepProgressBarFill');
        const mentalPointsSpan = document.getElementById('mentalPoints');
        const nutritionProgressBarFill = document.getElementById('nutritionProgressBarFill');
        const exerciseProgressBarFill = document.getElementById('exerciseProgressBarFill');
        const mentalProgressBarFill = document.getElementById('mentalProgressBarFill'); 
        const allDetailedRecommendations = document.getElementById('allDetailedRecommendations');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const copyMessage = document.getElementById('copyMessage');
        const restartQuizBtn = document.getElementById('restartQuizBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingMessage = document.getElementById('loadingMessage');
        const quizTip = document.getElementById('quizTip'); // Get the tip element
        const orientationBanner = document.getElementById('orientationBanner'); // Get the new banner element

        // Event Listener for the single Start Quiz button
        document.getElementById('startQuizBtn').addEventListener('click', startQuiz);

        // Event Listener for Next Button
        nextButton.addEventListener('click', async () => {
            const questionData = currentQuestions[currentQuestionIndex];
            let isValid = false;

            if (questionData.type === 'open-text') {
                if (document.getElementById('openAnswerTextarea') && document.getElementById('openAnswerTextarea').value.trim() !== '') {
                    isValid = true;
                }
            } else if (questionData.type === 'multiple-choice') {
                if (selectedOption !== null) {
                    isValid = true;
                }
            }

            if (isValid) {
                // Process the answer, which now might start an async AI call without awaiting
                await processAnswer(); // Still await processAnswer to ensure provisional score/feedback is recorded before moving on

                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuestions.length) {
                    // Start fade out animation
                    quizContainer.classList.remove('entered');
                    quizContainer.classList.add('exiting');

                    // Use setTimeout to change content and bring the container back into view
                    // after the expected duration of the exit animation (0.5s CSS transition).
                    setTimeout(() => {
                        quizContainer.classList.add('hidden'); // Ensure it's fully hidden before new content is rendered
                        quizContainer.classList.remove('exiting'); // Clean up the 'exiting' class

                        displayQuestion(); // Render the new question content

                        // Prepare for the fade-in animation
                        quizContainer.classList.remove('hidden');
                        quizContainer.classList.add('entering');
                        // Force reflow to ensure the animation restarts
                        void quizContainer.offsetWidth; 
                        // Activate the fade-in animation
                        quizContainer.classList.remove('entering');
                        quizContainer.classList.add('entered');
                    }, 550); // Slightly longer than the 0.5s CSS transition duration
                } else {
                    finishQuiz();
                }
            }
        });

        // Event Listener for Restart Quiz Button
        restartQuizBtn.addEventListener('click', restartQuiz);

        // Event Listener for Copy Link Button
        copyLinkBtn.addEventListener('click', copyShareLink);

        // Event Listener for Newsletter Gate: Button
        viewResultsButton.addEventListener('click', () => {
            // Bij het klikken op de knop, verberg de modal
            newsletterGateModal.classList.remove('visible'); 
            document.body.style.overflow = ''; // Schakel scrollen op de body weer in
        });

        /**
         * Initializes the quiz.
         */
        function startQuiz() {
            // Reset scores and feedback for a new quiz
            userScores = { nutrition: 0, exercise: 0, sleep: 0, mental: 0 };
            maxPossibleScores = { nutrition: 0, exercise: 0, sleep: 0, mental: 0 };
            userFeedback = { nutrition: [], exercise: [], sleep: [], mental: [] };
            currentQuestionIndex = 0;
            selectedOption = null; 
            nextButton.disabled = true;
            hasTriggeredNewsletterModal = false; // Reset the flag for new quiz session
            pendingAiScorePromises = []; // Clear pending promises for new quiz session

            // Calculate max possible scores for all questions
            healthCategories.forEach(category => {
                category.questions.forEach(q => {
                    if (q.type === 'open-text') {
                        maxPossibleScores[category.name] += q.maxPoints;
                    } else if (q.type === 'multiple-choice') {
                        const maxOptionScore = q.options.reduce((max, opt) => Math.max(max, opt.score), 0);
                        maxPossibleScores[category.name] += maxOptionScore;
                    }
                });
            });

            // Start fade out animation for startScreen
            startScreen.classList.remove('entered'); // Ensure it's not in entered state
            requestAnimationFrame(() => { // Ensure styles are applied before transition
                startScreen.classList.add('exiting');
            });

            startScreen.addEventListener('transitionend', function handler() {
                startScreen.removeEventListener('transitionend', handler); // Remove listener to prevent multiple calls
                startScreen.classList.add('hidden'); // Hide completely after animation
                startScreen.classList.remove('exiting'); // Clean up exiting class

                quizContainer.classList.remove('hidden'); // Show quiz container
                document.querySelector('.progress-bar-container').classList.remove('hidden'); // Show global progress bar
                
                // Initial animation for quiz container entrance
                quizContainer.classList.remove('exited');
                quizContainer.classList.remove('entered');
                quizContainer.classList.add('entering');
                void quizContainer.offsetWidth; 
                quizContainer.classList.remove('entering');
                quizContainer.classList.add('entered');
                
                displayQuestion();
            }, { once: true }); // Use { once: true } to automatically remove the listener
        }

        /**
         * Displays the current question and its options (textarea for open-ended or buttons for multiple-choice).
         */
        function displayQuestion() {
            const questionData = currentQuestions[currentQuestionIndex];
            questionDisplay.innerHTML = questionData.question; 
            optionsContainer.innerHTML = ''; 
            selectedOption = null; 
            nextButton.disabled = true; 

            if (questionData.type === 'open-text') {
                const textarea = document.createElement('textarea');
                textarea.id = 'openAnswerTextarea';
                textarea.placeholder = "Type your detailed response here...";
                textarea.rows = 6;
                textarea.classList.add('open-answer-textarea'); 
                textarea.style.textAlign = 'left';
                textarea.style.resize = 'vertical';
                textarea.style.minHeight = '100px';
                textarea.style.padding = '15px';
                optionsContainer.appendChild(textarea);

                textarea.addEventListener('input', () => {
                    nextButton.disabled = textarea.value.trim() === '';
                });
                nextButton.disabled = textarea.value.trim() === ''; 
                quizTip.classList.remove('hidden'); 
            } else if (questionData.type === 'multiple-choice') {
                questionData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option.text;
                    button.dataset.score = option.score; 
                    button.addEventListener('click', () => {
                        
                        document.querySelectorAll('.option-button').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        button.classList.add('selected');
                        selectedOption = option; 
                        nextButton.disabled = false; 
                    });
                    optionsContainer.appendChild(button);
                });
                quizTip.classList.add('hidden'); 
            }
            updateProgressBar();
        }

        /**
         * Processes the user's answer, updates scores and feedback.
         * Now starts AI processing in the background.
         */
        async function processAnswer() {
            const questionData = currentQuestions[currentQuestionIndex];
            let provisionalScore = 0; // Score based on simple metrics, updated by AI later

            if (questionData.type === 'open-text') {
                const textArea = document.getElementById('openAnswerTextarea');
                const answerText = textArea.value.trim();
                const textLength = answerText.length;

                // Calculate provisional score based on length for immediate display/progress
                if (textLength < 20) {
                    provisionalScore = Math.floor(questionData.maxPoints * 0.1);
                } else if (textLength < 100) {
                    provisionalScore = Math.floor(questionData.maxPoints * 0.3);
                } else {
                    provisionalScore = Math.floor(questionData.maxPoints * 0.5); // Assume a baseline good score for longer answers
                }
                
                // Add provisional score to userScores immediately
                userScores[questionData.category] += provisionalScore; 

                // Store feedback with provisional score for now
                userFeedback[questionData.category].push({
                    question: questionData.question,
                    answer: answerText,
                    openAnswer: answerText,
                    feedback: "Detailed insights provided by user.",
                    scoreImpact: provisionalScore, 
                    maxScoreForQuestion: questionData.maxPoints
                });

                // Start AI evaluation in the background, update score when it resolves
                const aiPromise = getAiQualityScore(questionData.question, answerText, questionData.category)
                    .then(aiResult => {
                        // When AI score comes back, update the actual score for the category
                        // We need to subtract the provisional score and add the AI-driven score.
                        const aiScoreEarned = Math.floor(questionData.maxPoints * aiResult.score);
                        userScores[aiResult.category] -= provisionalScore; // Subtract provisional score
                        userScores[aiResult.category] += aiScoreEarned; // Add actual AI score

                        // Also update the scoreImpact in userFeedback for accuracy in final display
                        const feedbackEntry = userFeedback[aiResult.category].find(f => f.openAnswer === answerText); 
                        if (feedbackEntry) {
                            feedbackEntry.scoreImpact = aiScoreEarned; 
                        }
                        console.log(`AI score for ${aiResult.category} resolved: ${aiScoreEarned}. Current total for category: ${userScores[aiResult.category]}`);
                    })
                    .catch(error => {
                        console.error(`Error processing AI score for ${questionData.category}:`, error);
                        // If AI fails, the provisional score remains as the category score.
                        // Optionally, add a user-facing message about AI failure.
                    });
                
                pendingAiScorePromises.push(aiPromise); // Keep track of the promise
                
            } else if (questionData.type === 'multiple-choice') {
                if (selectedOption) {
                    const scoreEarned = selectedOption.score;
                    userScores[questionData.category] += scoreEarned;
                    userFeedback[questionData.category].push({
                        question: questionData.question,
                        answer: selectedOption.text,
                        feedback: `Selected: ${selectedOption.text}`,
                        scoreImpact: scoreEarned,
                        maxScoreForQuestion: questionData.options.reduce((max, opt) => Math.max(max, opt.score), 0)
                    });
                }
            }
        }

        /**
         * Calls the Netlify Function to get a qualitative score for an open-ended answer.
         * @param {string} question - The original question text.
         * @param {string} answer - The user's answer text.
         * @param {string} category - The category this question belongs to.
         * @returns {Promise<{score: number, category: string}>} - A promise that resolves to the AI's score (0.0 to 1.0) and the category.
         */
        async function getAiQualityScore(question, answer, category) {
            const functionUrl = `${window.location.origin}/.netlify/functions/gemini-proxy`;
            const payload = {
                // Modified prompt to score based on perceived healthiness of the described habits
                prompt: `You are a health quiz evaluator. Your task is to objectively assess the healthiness of the lifestyle habits and practices described in the user's answer to a health-related question.
Rate the following user answer from 0.0 to 1.0, where 1.0 indicates highly healthy, optimal habits, and 0.0 indicates significantly unhealthy or non-existent habits. Base your score purely on the *implied health impact* of the activities, routines, or challenges the user describes, assuming a standard understanding of healthy living (e.g., balanced diet, regular exercise, sufficient sleep, effective stress management).

Original Question: "${question}"
User Answer: "${answer}"

Provide only a raw JSON object with a single key 'score' and its numerical value (float), with no surrounding text, markdown formatting, or code block delimiters. Example: { "score": 0.75 }`
            };

            const maxRetries = 3;
            let attempt = 0;
            const controller = new AbortController();
            let timeoutDuration = 30000; 
            let timeoutId;

            try {
                while (attempt < maxRetries) {
                    try {
                        timeoutId = setTimeout(() => controller.abort(), timeoutDuration); 
                        const response = await fetch(functionUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload),
                            signal: controller.signal 
                        });

                        clearTimeout(timeoutId); 

                        console.log(`API call for getAiQualityScore - Attempt ${attempt + 1}: Status ${response.status}, Content-Type: ${response.headers.get('Content-Type')}`);
                        const responseText = await response.text();
                        console.log("Raw response from Netlify Function (getAiQualityScore):", responseText);

                        if (!response.ok) {
                            console.error(`Netlify Function returned status ${response.status}. Full response: ${responseText}`);
                            throw new Error(`Netlify Function error: ${response.status}. Details in console.`);
                        }

                        const result = JSON.parse(responseText);

                        if (result.success && typeof result.response === 'string') {
                            const jsonString = result.response;
                            try {
                                const parsed = JSON.parse(jsonString);
                                if (typeof parsed.score === 'number') {
                                    return { score: Math.max(0, Math.min(1, parsed.score)), category: category }; 
                                } else {
                                    console.warn("AI returned invalid score format via Netlify Function:", parsed);
                                    throw new Error("Invalid AI score format from internal response.");
                                }
                            } catch (jsonParseError) {
                                console.error("Failed to parse AI's score JSON from the function's 'response' field:", jsonParseError, "Raw AI response:", jsonString);
                                throw new Error("AI response parsing error. Details in console.");
                            }
                        } else {
                            console.error("Netlify Function did not indicate success or response was not a string:", result);
                            throw new Error(`Netlify Function call failed: ${result.message || 'Unknown error'}. Details in console.`);
                        }
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            console.error(`API call timed out for getAiQualityScore (Attempt ${attempt + 1}):`, error);
                            // Do not show loading message here as it's a background process
                            throw new Error('API call timed out. Provisional score will be used.'); 
                        }
                        console.error(`API call attempt ${attempt + 1} failed for getAiQualityScore:`, error);
                        // Do not show loading message here as it's a background process
                        attempt++;
                        if (attempt >= maxRetries) {
                            throw new Error("Failed to get AI score after multiple attempts. Provisional score will be used.");
                        }
                        const delay = Math.pow(2, attempt) * 1000; 
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            } finally {
                if (timeoutId) clearTimeout(timeoutId); 
            }
            // Fallback if all retries fail, though the catch block should re-throw.
            // This line should ideally not be reached if error handling is robust.
            return { score: 0.1, category: category }; // Minimal fallback score if all else fails
        }


        /**
         * Updates the overall quiz progress bar.
         */
        function updateProgressBar() {
            const progress = (currentQuestionIndex / currentQuestions.length) * 100;
            progressBarFill.style.width = `${progress}%`;
            if (progress < 40) {
                progressBarFill.classList.remove('progress-medium', 'progress-high');
                progressBarFill.classList.add('progress-low');
            } else if (progress < 75) {
                progressBarFill.classList.remove('progress-low', 'progress-high');
                progressBarFill.classList.add('progress-medium');
            } else {
                progressBarFill.classList.remove('progress-low', 'progress-medium');
                progressBarFill.classList.add('progress-high');
            }
        }

        /**
         * Finishes the quiz, calculates overall score, and displays results.
         */
        async function finishQuiz() {
            quizContainer.classList.add('hidden'); // Hide quiz container immediately
            document.querySelector('.progress-bar-container').classList.add('hidden'); // Hide global progress bar

            showLoading('Finalizing your personalized results with AI...'); // New loading message, waiting for all background AI calls

            try {
                // Await all pending AI score promises before calculating final scores
                await Promise.all(pendingAiScorePromises);
                console.log("All AI scoring promises resolved. Final user scores:", userScores);
                pendingAiScorePromises = []; // Clear the array as all promises are settled

                let totalUserScore = 0;
                let totalMaxScore = 0;
                for (const category in userScores) {
                    totalUserScore += userScores[category];
                    totalMaxScore += maxPossibleScores[category];
                }
                
                const overallScorePercentage = totalMaxScore > 0 ? Math.round((totalUserScore / totalMaxScore) * 100) : 0;
                overallScoreDisplay.textContent = `Your Overall Health Score: ${overallScorePercentage}`; 
                overallProgressBarFill.style.width = `${overallScorePercentage}%`;
                updateProgressBarColor(overallProgressBarFill, overallScorePercentage);

                let overallFeedback = '';
                if (overallScorePercentage < 40) {
                    overallFeedback = "Your current health score suggests there are several areas where small, consistent improvements can lead to significant positive changes. This is a great starting point for your health journey!";
                } else if (overallScorePercentage < 75) {
                    overallFeedback = "You have a solid foundation for good health! With a few targeted adjustments, you can further optimize your well-being. Focus on the areas highlighted in your personalized recommendations.";
                } else {
                    overallFeedback = "Excellent work! Your health score indicates a strong commitment to your well-being. Keep up these great habits and explore advanced strategies to maintain your vitality.";
                }
                feedbackDisplay.textContent = overallFeedback;

                for (const category in userScores) {
                    const pointsSpan = document.getElementById(`${category}Points`);
                    const progressBarFillElement = document.getElementById(`${category}ProgressBarFill`);
                    
                    const categoryUserScore = userScores[category];
                    const categoryMaxScore = maxPossibleScores[category];
                    const categoryPercentage = categoryMaxScore > 0 ? Math.round((categoryUserScore / categoryMaxScore) * 100) : 0;

                    pointsSpan.textContent = categoryPercentage; 
                    progressBarFillElement.style.width = `${categoryPercentage}%`;
                    updateProgressBarColor(progressBarFillElement, categoryPercentage);
                }

                await generateAndDisplayDetailedRecommendations();

                hideLoading(); // Hide loading after results are ready

                // Controleer de local container 'emailSubmitted'
                const emailSubmitted = localStorage.getItem('emailSubmitted');

                if (emailSubmitted === 'true') {
                    // Als emailSubmitted true is, toon de resultaten direct
                    resultContainer.classList.remove('hidden');
                } else {
                    // Als emailSubmitted false is, toon de modal
                    resultContainer.classList.remove('hidden'); // Toon de resultaten, maar de modal ligt eroverheen
                    newsletterGateModal.classList.add('visible');
                    document.body.style.overflow = 'hidden'; // Voorkom scrollen
                    viewResultsButton.disabled = true; // De knop is standaard uitgeschakeld

                    // Nu luisteren we naar het 'emailSubmitted' item in localStorage
                    // Dit is een simpele manier om te controleren; in een echt scenario zou je dit op een robuustere manier doen,
                    // bijvoorbeeld door een custom event te triggeren vanuit de iframe van Beehiiv als dat mogelijk is,
                    // of door periodiek de status te controleren na een formulierinzending.
                    // Voor nu simuleren we de check op basis van de aanwezigheid van het item.
                    const checkEmailSubmittedInterval = setInterval(() => {
                        if (localStorage.getItem('emailSubmitted') === 'true') {
                            viewResultsButton.disabled = false; // Schakel de knop in
                            clearInterval(checkEmailSubmittedInterval); // Stop met controleren
                        }
                    }, 1000); // Controleer elke seconde
                }

            } catch (error) {
                console.error("Error during quiz completion or recommendation generation:", error);
                loadingMessage.textContent = `Oops! An error occurred: ${error.message || 'Unknown error'}. Please try again later.`; // More specific error message
                setTimeout(() => { hideLoading(); }, 3000); // Keep message for 3 seconds
                // Ensure loading overlay is hidden even if setTimeout is cleared
                hideLoading(); // This might be redundant if setTimeout always fires, but safe.
            }
        }

        /**
         * Updates the progress bar color based on the percentage.
         * @param {HTMLElement} element - The progress bar fill element.
         * @param {number} percentage - The percentage score.
         */
        function updateProgressBarColor(element, percentage) {
            element.classList.remove('progress-low', 'progress-medium', 'progress-high');
            if (percentage < 40) {
                element.classList.add('progress-low');
            } else if (percentage < 75) {
                element.classList.add('progress-medium');
            } else {
                element.classList.add('progress-high');
            }
        }

        /**
         * Generates and displays detailed recommendations using a Gemini API call.
         */
        async function generateAndDisplayDetailedRecommendations() {
            // showLoading('Generating personalized recommendations...'); // Loading handled by finishQuiz now
            allDetailedRecommendations.innerHTML = '<h3>Our Personalized Recommendations</h3>'; 

            const promptParts = [];
            for (const category in userFeedback) {
                if (userFeedback[category].length > 0) {
                    const categoryUserScore = userScores[category];
                    const categoryMaxScore = maxPossibleScores[category];
                    const categoryPercentage = categoryMaxScore > 0 ? Math.round((categoryUserScore / categoryMaxScore) * 100) : 0;

                    promptParts.push(`\n---`); 
                    promptParts.push(`For the ${category} category, the user's overall score was ${categoryPercentage} (a numerical value representing percentage).`);
                    
                    userFeedback[category].forEach(item => {
                        promptParts.push(`- Question: "${item.question.replace(/<br>/g, ' ')}"`);
                        promptParts.push(`  User's response: "${item.answer}"`); 
                    });
                }
            }

            const prompt = `Based on the following quiz results and the user's detailed responses, provide a concise, consolidated, and encouraging summary of personalized health recommendations.
Format your response as a raw JSON array of objects, with no surrounding text, markdown formatting, or code block delimiters. Each object in the array should have two properties:
1.  "title": A concise heading for the recommendation (e.g., "Nutrition Focus", "Improved Sleep Hygiene").
2.  "recommendation": A brief and actionable explanation of the advice.

The overall JSON output should contain 3-5 distinct recommendations. Focus on providing actionable steps and insights for continuous improvement and optimization for ALL categories that were evaluated (Nutrition, Exercise, Sleep, Mental Well-being), even if the user's score in that area is already high. Address any specific challenges or weaknesses mentioned in the user's detailed answers. The recommendations should be practical and empowering. The scores mentioned in the input are numerical values representing percentages. Do not explicitly use the word "percentage" or the "%" symbol in your generated recommendations, and integrate the score information naturally into the text if relevant.

Here are the user's detailed results:\n\n` + promptParts.join('\n');

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    maxOutputTokens: 4096
                }
            };

            const functionUrl = `${window.location.origin}/.netlify/functions/gemini-proxy`;
            
            let response;
            let result;
            const maxRetries = 5;
            let attempt = 0;
            const controller = new AbortController();
            let timeoutDuration = 30000; 
            let timeoutId;

            try {
                while (attempt < maxRetries) {
                    try {
                        timeoutId = setTimeout(() => controller.abort(), timeoutDuration); 
                        response = await fetch(functionUrl, { // Assign to outer scope response
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ prompt: prompt }),
                            signal: controller.signal 
                        });
                        
                        clearTimeout(timeoutId); 

                        console.log(`API call for generateAndDisplayDetailedRecommendations - Attempt ${attempt + 1}: Status ${response.status}, Content-Type: ${response.headers.get('Content-Type')}`);
                        const responseText = await response.text();
                        console.log("Raw response from Netlify Function (generateAndDisplayDetailedRecommendations):", responseText);

                        if (!response.ok) {
                            console.error(`Netlify Function returned status ${response.status}. Full response: ${responseText}`);
                            throw new Error(`Netlify Function error: ${response.status}. Details in console.`);
                        }

                        const parsedFunctionResponse = JSON.parse(responseText);

                        if (parsedFunctionResponse.success && typeof parsedFunctionResponse.response === 'string') {
                            let summaryText = parsedFunctionResponse.response;
                            const jsonStartMarkerRecs = '```json';
                            const jsonEndMarkerRecs = '```';

                            if (summaryText.startsWith(jsonStartMarkerRecs)) {
                                summaryText = summaryText.substring(jsonStartMarkerRecs.length);
                            }
                            if (summaryText.endsWith(jsonEndMarkerRecs)) {
                                summaryText = summaryText.substring(0, summaryText.length - jsonEndMarkerRecs.length);
                            }
                            summaryText = summaryText.trim(); 

                            try {
                                const recommendations = JSON.parse(summaryText);
                                if (Array.isArray(recommendations)) {
                                    recommendations.forEach(rec => {
                                        const recItem = document.createElement('div');
                                        recItem.classList.add('recommendation-item');
                                        const recTitle = document.createElement('h4');
                                        recTitle.textContent = rec.title;
                                        recItem.appendChild(recTitle);
                                        const recDescription = document.createElement('p');
                                        recDescription.textContent = rec.recommendation;
                                        recItem.appendChild(recDescription);
                                        allDetailedRecommendations.appendChild(recItem);
                                    });
                                } else {
                                    console.warn("AI returned JSON, but it's not an array of recommendations:", recommendations);
                                    const feedbackItem = document.createElement('p');
                                    feedbackItem.classList.add('detailed-feedback');
                                    feedbackItem.textContent = summaryText;
                                    allDetailedRecommendations.appendChild(feedbackItem);
                                }
                                break; 
                            } catch (jsonError) {
                                console.error("Failed to parse AI's response as JSON from the function's 'response' field:", jsonError, "Raw AI response:", summaryText);
                                throw new Error("AI response parsing error. Details in console.");
                            }
                        } else {
                            console.error("Netlify Function did not indicate success or response was not a string:", parsedFunctionResponse);
                            throw new Error(`Netlify Function call failed: ${parsedFunctionResponse.message || 'Unknown error'}. Details in console.`);
                        }
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            console.error(`API call timed out for generateAndDisplayDetailedRecommendations (Attempt ${attempt + 1}):`, error);
                            throw new Error('API call timed out. Please try again.');
                        }
                        console.error(`API call attempt ${attempt + 1} failed for generateAndDisplayDetailedRecommendations:`, error);
                        attempt++;
                        if (attempt >= maxRetries) {
                            throw error; 
                        }
                        const delay = Math.pow(2, attempt) * 1000; 
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            } catch (error) {
                console.error("Error generating recommendations:", error);
                const errorItem = document.createElement('div');
                errorItem.classList.add('recommendation-item');
                errorItem.innerHTML = '<h4>Error Generating Recommendations</h4><p>We encountered an issue generating your personalized recommendations. Please try the quiz again later, or contact support if the problem persists. Error: ' + (error.message || 'Unknown error') + '</p>';
                allDetailedRecommendations.appendChild(errorItem);
                throw error; 
            } finally {
                if (timeoutId) clearTimeout(timeoutId); 
            }
        }

        /**
         * Sets up a scroll event listener to trigger the newsletter modal.
         * The modal will appear once the user scrolls down a certain amount.
         */
        function setupScrollToTriggerModal() {
            // Dit is niet langer nodig, de modal wordt nu direct in finishQuiz() beheerd
            // op basis van localStorage.
        }


        /**
         * Resets the quiz to the start screen.
         */
        function restartQuiz() {
            quizContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            newsletterGateModal.classList.remove('visible'); 
            document.querySelector('.progress-bar-container').classList.add('hidden');
            startScreen.classList.remove('hidden');
            allDetailedRecommendations.innerHTML = '<h3>Our Personalized Recommendations</h3>';
            
            startScreen.classList.remove('exited');
            startScreen.classList.remove('entering');
            startScreen.classList.add('entered'); 
            
            hasTriggeredNewsletterModal = false; 
            document.body.style.overflow = ''; 
        }

        /**
         * Shows the loading overlay with an optional message.
         * @param {string} message = 'Loading...' - The message to display during loading.
         */
        function showLoading(message = 'Loading...') {
            loadingMessage.textContent = message;
            loadingOverlay.classList.remove('hidden');
            loadingOverlay.style.display = 'flex'; 
        }

        /**
         * Hides the loading overlay.
         */
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
            loadingOverlay.style.display = 'none'; 
        }

        /**
         * Copies the current page URL to the clipboard.
         */
        function copyShareLink() {
            console.log("Attempting to copy share link.");
            const currentUrl = window.location.href;
            const tempInput = document.getElementById('shareLinkInput'); 
            tempInput.value = currentUrl;
            tempInput.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    console.log('Copy command successful.');
                    copyMessage.classList.add('show');
                    setTimeout(() => {
                        copyMessage.classList.remove('show');
                    }, 3000); 
                } else {
                    console.warn('Copy command unsuccessful, falling back to manual copy.');
                    copyMessage.textContent = 'Copy failed. Please manually copy the link: ' + currentUrl;
                    copyMessage.classList.add('show');
                    setTimeout(() => {
                        copyMessage.classList.remove('show');
                        copyMessage.textContent = 'Link copied!'; 
                    }, 5000); 
                }
            } catch (err) {
                console.error('Error executing copy command:', err);
                copyMessage.textContent = 'Error copying. Please manually copy the link: ' + currentUrl;
                copyMessage.classList.add('show');
                setTimeout(() => {
                    copyMessage.classList.remove('show');
                    copyMessage.textContent = 'Link copied!'; 
                }, 5000); 
            }
            console.log("Copy share link function finished.");
        }

        /**
         * Checks the current screen orientation and displays/hides the banner.
         */
        function checkOrientationAndDisplayBanner() {
            const isMobile = window.innerWidth <= 768; 
            const isPortrait = window.matchMedia("(orientation: portrait)").matches;

            if (isMobile && isPortrait) {
                orientationBanner.style.display = 'block';
            } else {
                orientationBanner.style.display = 'none';
            }
        }


        // Initialize start screen to be "entered" on page load
        document.addEventListener('DOMContentLoaded', () => {
            startScreen.classList.add('entered');
            checkOrientationAndDisplayBanner(); 
        });

        // Listen for resize events (which includes orientation changes on mobile)
        window.addEventListener('resize', checkOrientationAndDisplayBanner);

        // Also listen for orientationchange for older mobile browsers
        if (window.matchMedia("(orientation: portrait)").addEventListener) {
            window.matchMedia("(orientation: portrait)").addEventListener("change", checkOrientationAndDisplayBanner);
            window.matchMedia("(orientation: landscape)").addEventListener("change", checkOrientationAndDisplayBanner);
        } else if (window.onorientationchange) {
            window.onorientationchange = checkOrientationAndDisplayBanner;
        }

        // Add the Beehiiv attribution script
        const beehiivAttributionScript = document.createElement('script');
        beehiivAttributionScript.type = 'text/javascript';
        beehiivAttributionScript.async = true;
        beehiivAttributionScript.src = 'https://subscribe-forms.beehiiv.com/attribution.js';
        document.head.appendChild(beehiivAttributionScript);

    </script>
</body>
</html>
